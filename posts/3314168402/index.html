<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xwnb.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="接下去主要介绍一下 AirSim 的 APIs 的使用, 主要参考 官方 文档, 并结合结合 OpenCV 来用 C++ 实现部分 官方 Python 的例程.">
<meta property="og:type" content="article">
<meta property="og:title" content="自动驾驶仿真 - AirSim (5) - 图片 APIs - C++">
<meta property="og:url" content="https://xwnb.github.io/posts/3314168402/index.html">
<meta property="og:site_name" content="Sun of Beach">
<meta property="og:description" content="接下去主要介绍一下 AirSim 的 APIs 的使用, 主要参考 官方 文档, 并结合结合 OpenCV 来用 C++ 实现部分 官方 Python 的例程.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xwnb.github.io/posts/3314168402/image-20200613175100646.png">
<meta property="og:image" content="https://xwnb.github.io/posts/3314168402/image-20200613184934655.png">
<meta property="og:image" content="https://microsoft.github.io/AirSim/images/unreal_editor_blocks.png">
<meta property="article:published_time" content="2020-06-22T15:44:54.000Z">
<meta property="article:modified_time" content="2020-06-22T15:52:58.191Z">
<meta property="article:author" content="村口最靓的 小Xu">
<meta property="article:tag" content="自动驾驶">
<meta property="article:tag" content="AirSim">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xwnb.github.io/posts/3314168402/image-20200613175100646.png">

<link rel="canonical" href="https://xwnb.github.io/posts/3314168402/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>
#needsharebutton-float {
  bottom: 88px;
  cursor: pointer;
  left: -8px;
  position: fixed;
  z-index: 9999;
}
#needsharebutton-float .btn {
  border: 1px solid $btn-default-border-color;
  border-radius: 4px;
  padding: 0 10px 0 14px;
}
</style>
  <title>自动驾驶仿真 - AirSim (5) - 图片 APIs - C++ | Sun of Beach</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Sun of Beach" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Sun of Beach</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Stay Angry, Stay Foolish</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/xwnb" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://xwnb.github.io/posts/3314168402/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/profile-picture.jpg">
      <meta itemprop="name" content="村口最靓的 小Xu">
      <meta itemprop="description" content="个人站，学习记录、实践教程、资料收集等，哈哈哈。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sun of Beach">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          自动驾驶仿真 - AirSim (5) - 图片 APIs - C++
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-22 23:44:54 / 修改时间：23:52:58" itemprop="dateCreated datePublished" datetime="2020-06-22T23:44:54+08:00">2020-06-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" itemprop="url" rel="index"><span itemprop="name">自动驾驶</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>接下去主要介绍一下 <code>AirSim</code> 的 <code>APIs</code> 的使用, 主要参考 <a href="https://microsoft.github.io/AirSim/image_apis/" target="_blank" rel="noopener">官方</a> 文档, 并结合结合 OpenCV 来用 C++ 实现部分 官方 Python 的例程.</p>
<a id="more"></a>
<hr>
<p>[TOC]</p>
<hr>
<h2 id="读取相机图片"><a href="#读取相机图片" class="headerlink" title="读取相机图片"></a>读取相机图片</h2><p>官方<a href="https://microsoft.github.io/AirSim/image_apis/" target="_blank" rel="noopener">例程</a> 提供了两种读取相机图片的方式 (需要修改, 代码参考如下). 这个例程获取 “0” 号相机的单幅图片. 返回值为 png 格式图片的字节. 如果要获取其他格式图片或者其他可用相机的图片参考下一小节.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"vehicles/multirotor/api/MultirotorRpcLibClient. hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getOneImage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for car use CarRpcLibClient</span></span><br><span class="line">    msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">    msr::airlib::<span class="built_in">vector</span>&lt;<span class="keyword">uint8_t</span>&gt; png_image = client. simGetImage(<span class="string">"0"</span>, VehicleCameraBase::ImageType::Scene);</span><br><span class="line">    <span class="comment">//do something with images</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="更加灵活的获取图片"><a href="#更加灵活的获取图片" class="headerlink" title="更加灵活的获取图片"></a>更加灵活的获取图片</h2><p><code>simGetImages</code> API 相比于 <code>simGetImage</code> API 更加复杂, 举个例子, 你可以通过单个 API 调用获取左侧、右侧、左侧的相机深度视图. <code>simGetImages</code>API 允许你获取未压缩的图片或者浮点单通道的图片数据 (而不是 8 位 3 通道 (RGB)).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImageRequest(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; camera_name_val, ImageCaptureBase::ImageType image_type_val, <span class="keyword">bool</span> pixels_as_float_val = <span class="literal">false</span>, <span class="keyword">bool</span> compress_val = <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>
<p><code>ImageRequest</code> 图片请求类的参数为</p>
<p><code>camera_name_val</code>: 相机编号, 可以输入 <code>&quot;0&quot;</code>, <code>&quot;1&quot;</code>, <code>&quot;2&quot;</code>, <code>&quot;3&quot;</code>, <code>&quot;4&quot;</code> 或者 <code>&quot;front_center&quot;</code>, <code>&quot;front_right&quot;</code>, <code>&quot;front_left&quot;</code>, <code>&quot;fpv&quot;</code>, <code>&quot;back_center&quot;</code>.</p>
<p><code>image_type_val</code>: 图片类型, 可支持的图片类型有:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Scene = <span class="number">0</span>,</span><br><span class="line">DepthPlanner = <span class="number">1</span>,</span><br><span class="line">DepthPerspective = <span class="number">2</span>,</span><br><span class="line">DepthVis = <span class="number">3</span>,</span><br><span class="line">DisparityNormalized = <span class="number">4</span>,</span><br><span class="line">Segmentation = <span class="number">5</span>,</span><br><span class="line">SurfaceNormals = <span class="number">6</span>,</span><br><span class="line">Infrared = <span class="number">7</span></span><br></pre></td></tr></table></figure>
<p><code>pixels_as_float_val</code>: 是否为浮点值, 默认为 <code>false</code>.</p>
<p><code>compress_val</code>: 是否是压缩数据, 默认为 <code>true</code></p>
<p><strong>PS:</strong> 后两个参数这里会影响到 opencv 的矩阵或者解码图片. 这里通过将一组图像请求信息 <code>ImageRequest</code> 放入容器中, 通过 <code>simGetImages</code> 一次性请求. 之后可通过迭代获取各个相机的图像数据.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getStereoAndDepthImages</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageRequest ImageRequest;</span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageResponse ImageResponse;</span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for car use</span></span><br><span class="line">    <span class="comment">//msr::airlib::CarRpcLibClient client;</span></span><br><span class="line">    msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">    msr::airlib::<span class="built_in">vector</span>&lt;ImageRequest&gt; request = &#123;</span><br><span class="line">        <span class="comment">//png format</span></span><br><span class="line">        ImageRequest(<span class="string">"0"</span>, ImageType::Scene),</span><br><span class="line">        <span class="comment">//uncompressed RGB array bytes</span></span><br><span class="line">        ImageRequest(<span class="string">"1"</span>, ImageType::Scene, <span class="literal">false</span>, <span class="literal">false</span>),</span><br><span class="line">        <span class="comment">//floating point uncompressed image</span></span><br><span class="line">        ImageRequest(<span class="string">"1"</span>, ImageType::DepthPlanner, <span class="literal">true</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">vector</span>&lt;ImageResponse&gt;&amp; response = client. simGetImages(request);</span><br><span class="line">    <span class="comment">//do something with response which contains image data, pose, timestamp etc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="通过-OpenCV-显示图片"><a href="#通过-OpenCV-显示图片" class="headerlink" title="通过 OpenCV 显示图片"></a>通过 <code>OpenCV</code> 显示图片</h2><p>虽然获取到的图片是 <code>uint8_t</code> 类型的数据, 但是无法通过直接转换成 <code>cv::Mat</code> 来使用 <code>OpenCV</code> 进行操作处理. 主要是获取到的是压缩的图片数据. 这里要使用 <code>cv::imdecode</code> 来对图片进行解码. 对应的两个 API 略有不同.</p>
<p>如果是压缩的数据：需要用 <code>cv::imdecode</code> 来解码生成 <code>cv::Mat</code> 的数据格式； 如果是非压缩的数据, 可以直接进行构造. 具体可见代码. 深度图片需要对 Mat 调用 <code>normalize</code> 归一化, 否则图片可能全白.</p>
<p>参考资料:</p>
<p><a href="https://github.com/microsoft/AirSim/issues/966" target="_blank" rel="noopener">https://github.com/microsoft/AirSim/issues/966</a></p>
<p><a href="https://github.com/Microsoft/AirSim/issues/491" target="_blank" rel="noopener">https://github.com/Microsoft/AirSim/issues/491</a></p>
<p>完整源码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"opencv2/opencv. hpp"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"vehicles/multirotor/api/MultirotorRpcLibClient. hpp"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ImageAPIs::getStereoAndDepthImages4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageRequest ImageRequest;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageResponse ImageResponse;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for car use</span></span><br><span class="line">  <span class="comment">// msr::airlib::CarRpcLibClient client;</span></span><br><span class="line">  msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">  msr::airlib::<span class="built_in">vector</span>&lt;ImageRequest&gt; request = &#123;<span class="comment">// png format</span></span><br><span class="line">                                               ImageRequest(<span class="string">"0"</span>, ImageType::Scene),</span><br><span class="line">                                               <span class="comment">// uncompressed RGB array bytes</span></span><br><span class="line">                                               ImageRequest(<span class="string">"1"</span>, ImageType::Scene, <span class="literal">false</span>, <span class="literal">false</span>),</span><br><span class="line">                                               <span class="comment">// floating point uncompressed image</span></span><br><span class="line">                                               ImageRequest(<span class="string">"1"</span>, ImageType::DepthPlanner, <span class="literal">true</span>)&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;ImageResponse&gt;&amp; response = client. simGetImages(request);</span><br><span class="line">      <span class="keyword">if</span> (response. <span class="built_in">size</span>() != request. <span class="built_in">size</span>()) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Images were not received!"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 左侧相机 ImageRequest("0", ImageType::Scene)</span></span><br><span class="line">      <span class="comment">// 默认参数是压缩数据, 调用 imdecode</span></span><br><span class="line">      cv::Mat left_mat = cv::imdecode(response. at(<span class="number">0</span>). image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">      cv::imshow(<span class="string">"left"</span>, left_mat);</span><br><span class="line">      cv::waitKey(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">      <span class="function">cv::Mat <span class="title">right_mat</span><span class="params">(response. at(<span class="number">1</span>). <span class="built_in">height</span>, response. at(<span class="number">1</span>). <span class="built_in">width</span>, CV_8UC3,</span></span></span><br><span class="line"><span class="function"><span class="params">                        (<span class="keyword">void</span>*)response. at(<span class="number">1</span>). image_data_uint8. data())</span></span>;</span><br><span class="line">      cv::imshow(<span class="string">"right"</span>, right_mat);</span><br><span class="line">      cv::waitKey(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 深度图片 ImageRequest("1", ImageType::DepthPlanner, true)</span></span><br><span class="line">      <span class="comment">// 这里需要对 Mat 调用 normalize 归一化, 否则图片可能全白.</span></span><br><span class="line">      <span class="function">cv::Mat <span class="title">gt_depth_mat</span><span class="params">(response. at(<span class="number">2</span>). <span class="built_in">height</span>, response. at(<span class="number">2</span>). <span class="built_in">width</span>, CV_32FC1,</span></span></span><br><span class="line"><span class="function"><span class="params">                           (<span class="keyword">void</span>*)response. at(<span class="number">2</span>). image_data_float. data())</span></span>;</span><br><span class="line">      cv::normalize(gt_depth_mat, gt_depth_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">      cv::imshow(<span class="string">"depth"</span>, gt_depth_mat);</span><br><span class="line">      cv::waitKey(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (rpc::timeout&amp; t) &#123;</span><br><span class="line">    <span class="comment">// will display a message like</span></span><br><span class="line">    <span class="comment">// rpc::timeout: Timeout of 50ms while calling RPC function 'sleep'</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; t. what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20200613175100646.png" alt="image-20200613175100646"></p>
<h2 id="可用的相机"><a href="#可用的相机" class="headerlink" title="可用的相机"></a>可用的相机</h2><h3 id="车"><a href="#车" class="headerlink" title="车"></a>车</h3><p><code>API</code> 可以通过一下相机名称调用: <code>&quot;front_center&quot;</code>, <code>&quot;front_right&quot;</code>, <code>&quot;front_left&quot;</code>, <code>&quot;fpv&quot;</code>, <code>&quot;back_center&quot;</code>. FPV 相机处于驾驶员头部位置 (First Person Virsion, 第一人称视角).</p>
<h3 id="飞行器"><a href="#飞行器" class="headerlink" title="飞行器"></a>飞行器</h3><p><code>API</code> 可以通过一下相机名称调用: <code>front_center</code>, <code>front_right</code>, <code>front_left</code>, <code>bottom_center</code> 和<code>back_center</code>.</p>
<h3 id="计算机视觉模式"><a href="#计算机视觉模式" class="headerlink" title="计算机视觉模式"></a>计算机视觉模式</h3><p>和飞行器的一致.</p>
<h3 id="向后兼容的相机名称"><a href="#向后兼容的相机名称" class="headerlink" title="向后兼容的相机名称"></a>向后兼容的相机名称</h3><p>在 AirSim v1. 2 之前, 相机是通过 ID 来指定的. 考虑到向后兼容, 依然可以用下相机的 ID 序号来代替, 顺序与上述名称保持一直. 此外, 相机名称为空字符串 <code>&quot;&quot;</code> 也是可以的, 也就是默认相机, 通常为 <code>&quot;0&quot;</code> .</p>
<h2 id="“Computer-Vision”-模式"><a href="#“Computer-Vision”-模式" class="headerlink" title="“Computer Vision” 模式"></a>“Computer Vision” 模式</h2><p>可以在 AirSim 中使用 “Computer Virsion” 模式. 在这个模式下, 物理引擎被禁用, 没有载具, 只有相机. 可以通过键盘移动视角 (按 F1 可以看帮助). 可以按下 Record 按钮来持续生成图片. 或者可以调用 APIs 来移动相机和获取图片.</p>
<p>编辑 <a href="https://microsoft.github.io/AirSim/settings/" target="_blank" rel="noopener">settings. json</a> 文件可以激活这种模式. 在用户的 <code>Documents\AirSim</code> 文件夹内 (Linux 则在 <code>Documents\AirSim</code>) 然后更改下列变量的值.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"SettingsVersion"</span>: <span class="number">1.</span> <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"SimMode"</span>: <span class="string">"ComputerVision"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py" target="_blank" rel="noopener">Python 例程</a> 移动相机并获取图片.</p>
<p>这是模式是受 <a href="http://unrealcv.org/" target="_blank" rel="noopener">UnrealCV project</a> 启发的.</p>
<p><strong>PS</strong>:</p>
<ul>
<li>我这里提供了 C++ 的版本, 直接用 OpenCV 动态显示了, 没有保存成图片格式.</li>
<li><code>settings. json</code> 编辑完成后, 不需要重启 UE 编辑器, 只要重新运行当前项目即可.</li>
<li>方向键调整相机位置(前后左右), wasd 调整朝向.</li>
<li>欧拉角转四元数可以参考 Eigen 库, 这里没写.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ImageAPIs::CVMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageRequest ImageRequest;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageResponse ImageResponse;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for car use</span></span><br><span class="line">  msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line">  client. confirmConnection();</span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Press any key to set camera-0 gimble to 15-degree pitch. \n"</span>;</span><br><span class="line">  <span class="built_in">std</span>::getchar();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO client. simSetCameraOrientation();</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Press any key to get camera parameters. \n"</span>;</span><br><span class="line">  <span class="built_in">std</span>::getchar();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> camera_name = <span class="number">0</span>; camera_name &lt; <span class="number">5</span>; ++camera_name) &#123;</span><br><span class="line">    CameraInfo camera_info = client. simGetCameraInfo(<span class="built_in">std</span>::to_string(camera_name));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"CameraInfo "</span> &lt;&lt; camera_name &lt;&lt; <span class="string">": \n"</span></span><br><span class="line">              &lt;&lt; <span class="string">"Pose: "</span> &lt;&lt; camera_info. pose. <span class="built_in">position</span>. x() &lt;&lt; <span class="string">" "</span> &lt;&lt; camera_info. pose. <span class="built_in">position</span>. y() &lt;&lt; <span class="string">" "</span></span><br><span class="line">              &lt;&lt; camera_info. pose. <span class="built_in">position</span>. z() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span></span><br><span class="line">              &lt;&lt; <span class="string">"FOV: "</span> &lt;&lt; camera_info. fov &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">  msr::airlib::<span class="built_in">vector</span>&lt;ImageRequest&gt; request = &#123;ImageRequest(<span class="string">"0"</span>, ImageType::DepthVis),</span><br><span class="line">                                               ImageRequest(<span class="string">"1"</span>, ImageType::DepthPerspective, <span class="literal">true</span>),</span><br><span class="line">                                               ImageRequest(<span class="string">"2"</span>, ImageType::Segmentation),</span><br><span class="line">                                               ImageRequest(<span class="string">"3"</span>, ImageType::Scene),</span><br><span class="line">                                               ImageRequest(<span class="string">"4"</span>, ImageType::DisparityNormalized),</span><br><span class="line">                                               ImageRequest(<span class="string">"4"</span>, ImageType::SurfaceNormals)&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">/* TODO</span></span><br><span class="line"><span class="comment">   client. simSetVehiclePose();</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> msr::airlib::<span class="built_in">vector</span>&lt;ImageResponse&gt;&amp; responses = client. simGetImages(request);</span><br><span class="line">    <span class="comment">// do something with response which contains image data, pose, timestamp etc</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; responses. <span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">strid</span><span class="params">(<span class="built_in">std</span>::to_string(i))</span></span>;</span><br><span class="line">      <span class="keyword">const</span> <span class="keyword">auto</span>&amp; response = responses. at(i);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (response. pixels_as_float) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Type "</span> &lt;&lt; <span class="keyword">int</span>(response. image_type) &lt;&lt; <span class="string">", size "</span> &lt;&lt; response. image_data_float. <span class="built_in">size</span>() &lt;&lt; <span class="string">", pos "</span></span><br><span class="line">                  &lt;&lt; response. camera_position. x() &lt;&lt; <span class="string">" "</span> &lt;&lt; response. camera_position. y() &lt;&lt; <span class="string">" "</span></span><br><span class="line">                  &lt;&lt; response. camera_position. z() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Type "</span> &lt;&lt; <span class="keyword">int</span>(response. image_type) &lt;&lt; <span class="string">", size "</span> &lt;&lt; response. image_data_uint8. <span class="built_in">size</span>() &lt;&lt; <span class="string">", pos "</span></span><br><span class="line">                  &lt;&lt; response. camera_position. x() &lt;&lt; <span class="string">" "</span> &lt;&lt; response. camera_position. y() &lt;&lt; <span class="string">" "</span></span><br><span class="line">                  &lt;&lt; response. camera_position. z() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (response. image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> ImageType::Scene:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":Scene-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_8UC3, (<span class="keyword">void</span>*)response. image_data_uint8. data());</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":Scene-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthPlanner:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DepthPlanner-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_32FC1, (<span class="keyword">void</span>*)response. image_data_float. data());</span><br><span class="line">            cv::normalize(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DepthPlanner-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthPerspective:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DepthPerspective-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            <span class="comment">// cv::Mat img_mat = cv::imdecode(response. image_data_float, cv::IMREAD_GRAYSCALE);</span></span><br><span class="line">            cv::Mat img_mat(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_32FC1, (<span class="keyword">void</span>*)response. image_data_float. data());</span><br><span class="line">            cv::normalize(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DepthPerspective-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthVis:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DepthVis-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DisparityNormalized:</span><br><span class="line">          <span class="keyword">if</span> (response. pixels_as_float) &#123;</span><br><span class="line">            <span class="function">cv::Mat <span class="title">img_mat</span><span class="params">(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_32FC1, (<span class="keyword">void</span>*)response. image_data_float. data())</span></span>;</span><br><span class="line">            cv::normalize(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":DisparityNormalized-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::Segmentation:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":Segmentation-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_8UC3, (<span class="keyword">void</span>*)response. image_data_uint8. data());</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":Segmentation-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::SurfaceNormals:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::imdecode(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":SurfaceNormals-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat(response. <span class="built_in">height</span>, response. <span class="built_in">width</span>, CV_8UC3, (<span class="keyword">void</span>*)response. image_data_uint8. data());</span><br><span class="line">            cv::imshow(response. camera_name + <span class="string">":SurfaceNormals-"</span> + strid, img_mat);</span><br><span class="line">            cv::waitKey(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">auto</span> pose = client. simGetVehiclePose();</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Vehicle Pose: "</span> &lt;&lt; pose. <span class="built_in">position</span>. x() &lt;&lt; <span class="string">" "</span> &lt;&lt; pose. <span class="built_in">position</span>. y() &lt;&lt; <span class="string">" "</span> &lt;&lt; pose. <span class="built_in">position</span>. y()</span><br><span class="line">                &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="image-20200613184934655.png" alt="image-20200613184934655"></p>
<h3 id="在-Computer-Vision-模式下设置位姿"><a href="#在-Computer-Vision-模式下设置位姿" class="headerlink" title="在 Computer Vision 模式下设置位姿"></a>在 Computer Vision 模式下设置位姿</h3><p>为了在环境中通过 <code>APIs</code> 移动, 可以用过 <code>simSetVehiclePose</code> API. 这个 API 传入位置和姿态参数, 将不可见的载具设置在 <code>front-center</code> 相机所处的位置. 其他的相机保持相对的位置移动. 如果不想改变位置或者姿态, 只需要将位置和姿态设置为 nan 的浮点数. <code>simGetVehiclePose</code> 可以获取当前位姿, 你可以用 <code>simGetGroundTruthKinematics</code> 来获取 quantities kinematics quantities for the movement (不太明白这意思). 还有很多其他无载具特定的 APIs 也是可用, 比如 分割 APIs, 碰撞 APIs, 相机 APIs.</p>
<h2 id="相机-APIs"><a href="#相机-APIs" class="headerlink" title="相机 APIs"></a>相机 APIs</h2><p><code>simGetCameraInfo</code> 返回指定相机的位姿 (世界场景, NED 坐标系, 国际标准单位制) 和 FOV (角度) . 可参考例程 <a href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py" target="_blank" rel="noopener">example usage</a>.</p>
<p><code>simSetCameraOrientation</code> 设置指定相机在 NED 坐标系下的位姿(四元数). 函数 <code>airsim. to_quaternion()</code> 用来将俯仰, 翻转, 偏航角度转化为四元数, 举个例子, 设置相机 - 0 倾斜角度为 15 度, 可以用 (<strong>PS</strong>: 这个是 Python 版本, C++ 没找到, 可以自己用 Eigen 库实现) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client. simSetCameraOrientation(<span class="number">0</span>, airsim. to_quaternion(<span class="number">0.</span> <span class="number">261799</span>, <span class="number">0</span>, <span class="number">0</span>)); <span class="comment">#radians</span></span><br></pre></td></tr></table></figure>
<h3 id="Gimbal"><a href="#Gimbal" class="headerlink" title="Gimbal"></a>Gimbal</h3><p>可以 <a href="https://microsoft.github.io/AirSim/settings/#gimbal" target="_blank" rel="noopener">using settings</a> 将任意相机设置为俯仰, 翻转, 偏航角度.</p>
<p>请参考 <a href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py" target="_blank" rel="noopener">example usage</a>.</p>
<h2 id="修改分辨率和相机参数"><a href="#修改分辨率和相机参数" class="headerlink" title="修改分辨率和相机参数"></a>修改分辨率和相机参数</h2><p>通过 <a href="https://microsoft.github.io/AirSim/settings/" target="_blank" rel="noopener">settings. json</a> 可以修改分辨率和视场角. 举个例子, 下述 settings. json 的额外部分设置了捕捉场景的参数, 并用前述的 “Computer Version” 模式. 如果你省略了任何设置, 下述默认参数将会被使用. 更多设置参见 <a href="https://microsoft.github.io/AirSim/settings/" target="_blank" rel="noopener">settings doc</a>. 如果你正在使用立体相机, 左右两个相机的固定距离是 25 cm.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"SettingsVersion"</span>: <span class="number">1.</span> <span class="number">2</span>,</span><br><span class="line">  <span class="attr">"CameraDefaults"</span>: &#123;</span><br><span class="line">    <span class="attr">"CaptureSettings"</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"ImageType"</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">"Width"</span>: <span class="number">256</span>,</span><br><span class="line">        <span class="attr">"Height"</span>: <span class="number">144</span>,</span><br><span class="line">        <span class="attr">"FOV_Degrees"</span>: <span class="number">90</span>,</span><br><span class="line">        <span class="attr">"AutoExposureSpeed"</span>: <span class="number">100</span>,</span><br><span class="line">        <span class="attr">"MotionBlurAmount"</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"SimMode"</span>: <span class="string">"ComputerVision"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="在不同的图像类型像素值表示什么"><a href="#在不同的图像类型像素值表示什么" class="headerlink" title="在不同的图像类型像素值表示什么"></a>在不同的图像类型像素值表示什么</h2><h3 id="可用的图像类型"><a href="#可用的图像类型" class="headerlink" title="可用的图像类型"></a>可用的图像类型</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Scene = <span class="number">0</span>,</span><br><span class="line">DepthPlanner = <span class="number">1</span>,</span><br><span class="line">DepthPerspective = <span class="number">2</span>,</span><br><span class="line">DepthVis = <span class="number">3</span>,</span><br><span class="line">DisparityNormalized = <span class="number">4</span>,</span><br><span class="line">Segmentation = <span class="number">5</span>,</span><br><span class="line">SurfaceNormals = <span class="number">6</span>,</span><br><span class="line">Infrared = <span class="number">7</span></span><br></pre></td></tr></table></figure>
<h3 id="DepthPlanner-and-DepthPerspective"><a href="#DepthPlanner-and-DepthPerspective" class="headerlink" title="DepthPlanner and DepthPerspective"></a>DepthPlanner and DepthPerspective</h3><p>通常你希望在接收到 float 表示的深度图像 ( 即在<code>ImageRequest</code> 将设置 <code>pixels_as_float = true</code>) 然后指定 <code>ImageType = DepthPlanner</code> 或者 <code>ImageType = DepthPerspective</code> . 对于 <code>ImageType = DepthPlanner</code>, 将获得获得深度, 即所有与相机处于相同距离的点具有相同的深度. 对于 <code>ImageType = DepthPerspective</code>, 通过射向像素点的射线来获取深度. 取决与使用的案例, 平行深度或者透视深度可能是所需的真正图像. 举个例子, 你可能对 ROS 包发布透视深度, 例如 <code>depth_image_proc</code> 来生成点云. 或者平行深度可能通过立体视觉算法, 例如 SGM, 用来估计深度图像的生成.</p>
<h3 id="DepthVis"><a href="#DepthVis" class="headerlink" title="DepthVis"></a>DepthVis</h3><p>当在 <code>ImageRequest</code> 指定 <code>ImageType = DepthVis</code>, 将获得一副有助于可视化深度的图像. 在这种请跨下, 每个像素值是米值的根据相机平面从白到黑的插值. 纯白的像素意味着深度超过 100 m, 纯黑意味着深度为 0 m.</p>
<h3 id="DisparityNormalized"><a href="#DisparityNormalized" class="headerlink" title="DisparityNormalized"></a>DisparityNormalized</h3><p>通常你希望在接收到 float 表示的深度图像 ( 即在<code>ImageRequest</code> 设置 <code>pixels_as_float = true</code> <code>ImageType = DisparityNormalized</code> ) . 这种情况下, 每个像素值是 <code>(Xl - Xr)/Xmax</code>, 即被归一化为 0 到 1 之间的值.</p>
<h3 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h3><p>当在 <code>ImageRequest</code> 指定 <code>ImageType = Segmentation</code> , 将获取到真实场景的分割图. 在启动时, AirSim 给环境中每块网格分配 0 到 255 的值. 这些值将映射 <a href="https://github.com/Microsoft/AirSim/tree/master/Unreal//Plugins/AirSim/Content/HUDAssets/seg_color_pallet.png" target="_blank" rel="noopener">the pallet</a> 中指定的颜色. 每个对象的 ID 可以在 <a href="https://microsoft.github.io/AirSim/seg_rgbs.txt" target="_blank" rel="noopener">this file</a> 找到.</p>
<p>你可以通过 APIs 给指定的网格分配指定的值 (范围限制在 0-255) . 举个例子, 下述的 Python (PS: C++ 代码相同) 代码给一个对象 ID 为 ”Ground“ 在 Blocks 环境中的值为 20, 所以改变了该对象在分割视图中的颜色:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success = client. simSetSegmentationObjectID(<span class="string">"Ground"</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>
<p>返回的布尔值表示是否找到该网格.</p>
<p>主要, 典型的 Unreal 环境中, 像 Blocks, 通常有很多其他有相同对象组成的网格, 举个例子, “Ground_2”, “Ground_3” 等等. 因为对所有网格设置对象 ID 是很冗杂的, AirSim 也支持正则表达式. 举个例子, 以下只用了一行代码设置了名称以 ”ground“ 开头的所有网格为 21 (忽略大小写) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success = client. simSetSegmentationObjectID(<span class="string">"ground[\w]*"</span>, <span class="number">21</span>, <span class="literal">True</span>);</span><br></pre></td></tr></table></figure>
<p>如果至少有一个网格被正则表达式匹配, 则返回 true.</p>
<p>建议通过这个 API 来请求未压缩的分割图像, 确保获取到精确的 RGB 值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">responses = client. simGetImages([ImageRequest(<span class="number">0</span>, AirSimImageType. Segmentation, <span class="literal">False</span>, <span class="literal">False</span>)])</span><br><span class="line">img1d = np. fromstring(response. image_data_uint8, dtype=np. uint8) <span class="comment">#get numpy array</span></span><br><span class="line">img_rgb = img1d. reshape(response. height, response. width, <span class="number">3</span>) <span class="comment">#reshape array to 3 channel image array H X W X 3</span></span><br><span class="line">img_rgb = np. flipud(img_rgb) <span class="comment">#original image is fliped vertically</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#find unique colors</span></span><br><span class="line">print(np. unique(img_rgb[:, :, <span class="number">0</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#red</span></span><br><span class="line">print(np. unique(img_rgb[:, :, <span class="number">1</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#green</span></span><br><span class="line">print(np. unique(img_rgb[:, :, <span class="number">2</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#blue</span></span><br></pre></td></tr></table></figure>
<p>完整可运行的程序见 <a href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/segmentation.py" target="_blank" rel="noopener">segmentation. py</a>.</p>
<h4 id="Unsetting-object-ID"><a href="#Unsetting-object-ID" class="headerlink" title="Unsetting object ID"></a>Unsetting object ID</h4><p>如果不想在分割图像中显示对象, 可以设置对象 ID 为 -1.</p>
<h4 id="如何找到网格的名字"><a href="#如何找到网格的名字" class="headerlink" title="如何找到网格的名字"></a>如何找到网格的名字</h4><p>为了获取真实的分割图, 你需要知道在 Unreal 环境中的网格名称. 打开 UE 编辑器中的 Unreal 环境, 然后在世界大纲视图 (World Outliner) 中找到感兴趣的网格. 举个例子, 下述图片我们可以在右侧 Blocks 环境面板中看到 ground 的网格名称:</p>
<p><img data-src="https://microsoft.github.io/AirSim/images/unreal_editor_blocks.png" alt="record screenshot"></p>
<p>如果你不知道如何在 Unreal 编辑器中打开 Unreal 环境, 可以参考下列教程 <a href="https://microsoft.github.io/AirSim/build_windows/" target="_blank" rel="noopener">building from source</a>.</p>
<p>一旦你决定你感兴趣的网格, 几下它们的名称, 然后通过上述的 API 来设置它们的 object IDs. 这里有 <a href="https://microsoft.github.io/AirSim/settings/#segmentation-settings" target="_blank" rel="noopener">few settings</a> 来改变生成 object ID 的行为.</p>
<h4 id="修改-Object-IDs-的颜色"><a href="#修改-Object-IDs-的颜色" class="headerlink" title="修改 Object IDs 的颜色"></a>修改 Object IDs 的颜色</h4><p>目前每个对象 ID 都在 <a href="https://github.com/Microsoft/AirSim/tree/master/Unreal//Plugins/AirSim/Content/HUDAssets/seg_color_pallet.png" target="_blank" rel="noopener">this pallet</a> 被固定. 我们将很快增加改变 object IDs 颜色的功能. 同时, 你将可以在你喜欢的图像编辑器中打开分割图, 然后获取你感兴趣的 RGB 值.</p>
<h4 id="Startup-Object-IDs"><a href="#Startup-Object-IDs" class="headerlink" title="Startup Object IDs"></a>Startup Object IDs</h4><p>开始时, AirSim 给能在环境中的<code>UStaticMeshComponent</code> 或者 <code>ALandscapeProxy</code> 类型的每个对象分配了 object id. 然后使用网格名称或者本身的名称 (取决于设置), 转换为小写, 移除所有小于 ASCII 97 的字符以移除数字和一些标点, 对所有字符求和并除以 255 取模来生成 object id. 换句话说, 所具有相同字符的对象将有相同的 object ID. 这个启发对于很多 Unreal 环境很简单也有有效, 但是可能不是你想要的. 这种情况下, 请用上面的 APIs 来修改 object IDs 为你想要的值. 这里可以设置可能修改这些表现 r.</p>
<h4 id="为网格获取-Object-ID"><a href="#为网格获取-Object-ID" class="headerlink" title="为网格获取 Object ID"></a>为网格获取 Object ID</h4><p><code>simGetSegmentationObjectID</code> API 允许你获取一个指定网格名称的 object ID.</p>
<h3 id="Infrared"><a href="#Infrared" class="headerlink" title="Infrared"></a>Infrared</h3><p>目前, 这只是将 object ID 映射为 0-255 灰度域的映射. 所以很多 object ID 42 的网格均已 (42, 42, 42) 的颜色显示. 请参考 <a href="https://microsoft.github.io/AirSim/image_apis/#segmentation" target="_blank" rel="noopener">segmentation section</a> 获取如何设置 object IDs 更多的细节. 通常, 噪声设置可以被运用在这种图像类型, 以获取细微的更加真实效果. 我们依然在增加其他的 infrared artifacts 方面展开工作, 也欢迎任何的 contributions .</p>
<h2 id="例程代码"><a href="#例程代码" class="headerlink" title="例程代码"></a>例程代码</h2><p>设置载具到任意方位和获取图片的代码可以在 <a href="https://github.com/Microsoft/AirSim/tree/master/Examples/DataCollection/StereoImageGenerator.hpp" target="_blank" rel="noopener">GenerateImageGenerator. hpp</a> 找到. 这个例程生成指定数量的立体图像和地面实况视差图像, 并保存为 <a href="https://microsoft.github.io/AirSim/pfm/" target="_blank" rel="noopener">pfm format</a>.</p>

    </div>

    
    
    
      
  <div class="popular-posts-header">推荐文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\posts\4243726933\" rel="bookmark">自动驾驶仿真 - AirSim (1) - Windows 10 下安装仿真平台 AirSim - v1.3.1</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\posts\2194771931\" rel="bookmark">自动驾驶仿真 - AirSim (2) - 创建并设置 Unreal Engine 环境</a></div>
    </li>
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\posts\531482360\" rel="bookmark">自动驾驶仿真 - AirSim (3) - 配置 Visual Studio 工程</a></div>
    </li>
  </ul>

        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.jpg" alt="村口最靓的 小Xu 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="村口最靓的 小Xu 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>村口最靓的 小Xu
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://xwnb.github.io/posts/3314168402/" title="自动驾驶仿真 - AirSim (5) - 图片 APIs - C++">https://xwnb.github.io/posts/3314168402/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://blog.csdn.net/xiaowei1234565">
            <span class="icon">
              <i class="fab fa-blogger"></i>
            </span>

            <span class="label">CSDN</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" rel="tag"><i class="fa fa-tag"></i> 自动驾驶</a>
              <a href="/tags/AirSim/" rel="tag"><i class="fa fa-tag"></i> AirSim</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/posts/1270863220/" rel="prev" title="自动驾驶仿真 - AirSim (6) - 设置">
      <i class="fa fa-chevron-left"></i> 自动驾驶仿真 - AirSim (6) - 设置
    </a></div>
      <div class="post-nav-item">
    <a href="/posts/1307933338/" rel="next" title="自动驾驶仿真 - AirSim (4) - 核心 APIs - C++">
      自动驾驶仿真 - AirSim (4) - 核心 APIs - C++ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#读取相机图片"><span class="nav-text">读取相机图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#更加灵活的获取图片"><span class="nav-text">更加灵活的获取图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#通过-OpenCV-显示图片"><span class="nav-text">通过 OpenCV 显示图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#可用的相机"><span class="nav-text">可用的相机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#车"><span class="nav-text">车</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#飞行器"><span class="nav-text">飞行器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#计算机视觉模式"><span class="nav-text">计算机视觉模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#向后兼容的相机名称"><span class="nav-text">向后兼容的相机名称</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#“Computer-Vision”-模式"><span class="nav-text">“Computer Vision” 模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#在-Computer-Vision-模式下设置位姿"><span class="nav-text">在 Computer Vision 模式下设置位姿</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#相机-APIs"><span class="nav-text">相机 APIs</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Gimbal"><span class="nav-text">Gimbal</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#修改分辨率和相机参数"><span class="nav-text">修改分辨率和相机参数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#在不同的图像类型像素值表示什么"><span class="nav-text">在不同的图像类型像素值表示什么</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#可用的图像类型"><span class="nav-text">可用的图像类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DepthPlanner-and-DepthPerspective"><span class="nav-text">DepthPlanner and DepthPerspective</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DepthVis"><span class="nav-text">DepthVis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DisparityNormalized"><span class="nav-text">DisparityNormalized</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Segmentation"><span class="nav-text">Segmentation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Unsetting-object-ID"><span class="nav-text">Unsetting object ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#如何找到网格的名字"><span class="nav-text">如何找到网格的名字</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#修改-Object-IDs-的颜色"><span class="nav-text">修改 Object IDs 的颜色</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Startup-Object-IDs"><span class="nav-text">Startup Object IDs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#为网格获取-Object-ID"><span class="nav-text">为网格获取 Object ID</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Infrared"><span class="nav-text">Infrared</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#例程代码"><span class="nav-text">例程代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="村口最靓的 小Xu"
      src="/images/profile-picture.jpg">
  <p class="site-author-name" itemprop="name">村口最靓的 小Xu</p>
  <div class="site-description" itemprop="description">个人站，学习记录、实践教程、资料收集等，哈哈哈。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xwnb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xwnb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/www.weibo.com" title="Weibo → www.weibo.com"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="/www.google.com" title="Google → www.google.com"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Friend Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/xiaowei1234565" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiaowei1234565" rel="noopener" target="_blank">CSDN</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;" rel="noopener" target="_blank">CNBLOGS</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.oschina.net/" title="https:&#x2F;&#x2F;www.oschina.net&#x2F;" rel="noopener" target="_blank">OSCHINA</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.v2ex.com/" title="https:&#x2F;&#x2F;www.v2ex.com&#x2F;" rel="noopener" target="_blank">V2EX</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user-circle"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">村口最靓的 小Xu</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">50k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">45 分钟</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>













  

  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://xwnb.github.io/posts/3314168402/',]
      });
      });
  </script>
<div id="needsharebutton-float">
      <span class="btn">
        <i class="fa fa-share-alt" aria-hidden="true"></i>
      </span>
    </div>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script>
  <script>
      flOptions = {};
        flOptions.iconStyle = "box";
        flOptions.boxForm = "vertical";
        flOptions.position = "middleRight";
        flOptions.networks = "Weibo,Wechat,Douban,QQZone,Twitter,Facebook";
      new needShareButton('#needsharebutton-float', flOptions);
  </script>
</body>
</html>

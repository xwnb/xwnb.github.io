<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="ä¸ªäººç«™ï¼Œå­¦ä¹ è®°å½•ã€å®è·µæ•™ç¨‹ã€èµ„æ–™æ”¶é›†ç­‰ï¼Œå“ˆå“ˆå“ˆã€‚"><title>è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (5) - å›¾ç‰‡ APIs - C++ | Sun of Beach</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">ğŸŒ“</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (5) - å›¾ç‰‡ APIs - C++</h1><a id="logo" href="/.">Sun of Beach</a><p class="description">Stay Angry, Stay Foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> é¦–é¡µ</i></a><a href="/archives/"><i class="fa fa-archive"> å½’æ¡£</i></a><a href="/about/"><i class="fa fa-user"> å…³äº</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (5) - å›¾ç‰‡ APIs - C++</h1><div class="post-meta">2020-06-22<span> | </span><span class="category"><a href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">è‡ªåŠ¨é©¾é©¶</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> é˜…è¯»</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 4.2k</span><span class="post-meta-item-text"> å­—</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 19</span><span class="post-meta-item-text"> åˆ†é’Ÿ</span></span></span></div><div class="post-content"><p>æ¥ä¸‹å»ä¸»è¦ä»‹ç»ä¸€ä¸‹ <code>AirSim</code> çš„ <code>APIs</code> çš„ä½¿ç”¨, å‚è€ƒ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/image_apis/">å®˜æ–¹</a> æ–‡æ¡£, å¹¶ç»“åˆç»“åˆ OpenCV æ¥ç”¨ C++ å®ç°éƒ¨åˆ† å®˜æ–¹ Python çš„ä¾‹ç¨‹.</p>
<span id="more"></span>

<hr>
<p>[TOC]</p>
<hr>
<h2 id="è¯»å–ç›¸æœºå›¾ç‰‡"><a href="#è¯»å–ç›¸æœºå›¾ç‰‡" class="headerlink" title="è¯»å–ç›¸æœºå›¾ç‰‡"></a>è¯»å–ç›¸æœºå›¾ç‰‡</h2><p>å®˜æ–¹<a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/image_apis/">ä¾‹ç¨‹</a> æä¾›äº†ä¸¤ç§è¯»å–ç›¸æœºå›¾ç‰‡çš„æ–¹å¼ (éœ€è¦ä¿®æ”¹, ä»£ç å‚è€ƒå¦‚ä¸‹). è¿™ä¸ªä¾‹ç¨‹è·å– â€œ0â€ å·ç›¸æœºçš„å•å¹…å›¾ç‰‡. è¿”å›å€¼ä¸º png æ ¼å¼å›¾ç‰‡çš„å­—èŠ‚. å¦‚æœè¦è·å–å…¶ä»–æ ¼å¼å›¾ç‰‡æˆ–è€…å…¶ä»–å¯ç”¨ç›¸æœºçš„å›¾ç‰‡å‚è€ƒä¸‹ä¸€å°èŠ‚.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;vehicles/multirotor/api/MultirotorRpcLibClient. hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">getOneImage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for car use CarRpcLibClient</span></span><br><span class="line">    msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">    msr::airlib::vector&lt;<span class="type">uint8_t</span>&gt; png_image = client. <span class="built_in">simGetImage</span>(<span class="string">&quot;0&quot;</span>, VehicleCameraBase::ImageType::Scene);</span><br><span class="line">    <span class="comment">//do something with images</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ›´åŠ çµæ´»çš„è·å–å›¾ç‰‡"><a href="#æ›´åŠ çµæ´»çš„è·å–å›¾ç‰‡" class="headerlink" title="æ›´åŠ çµæ´»çš„è·å–å›¾ç‰‡"></a>æ›´åŠ çµæ´»çš„è·å–å›¾ç‰‡</h2><p><code>simGetImages</code> API ç›¸æ¯”äº <code>simGetImage</code> API æ›´åŠ å¤æ‚, ä¸¾ä¸ªä¾‹å­, ä½ å¯ä»¥é€šè¿‡å•ä¸ª API è°ƒç”¨è·å–å·¦ä¾§ã€å³ä¾§ã€å·¦ä¾§çš„ç›¸æœºæ·±åº¦è§†å›¾. <code>simGetImages</code>API å…è®¸ä½ è·å–æœªå‹ç¼©çš„å›¾ç‰‡æˆ–è€…æµ®ç‚¹å•é€šé“çš„å›¾ç‰‡æ•°æ® (è€Œä¸æ˜¯ 8 ä½ 3 é€šé“ (RGB)).</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ImageRequest</span>(<span class="type">const</span> std::string&amp; camera_name_val, ImageCaptureBase::ImageType image_type_val, <span class="type">bool</span> pixels_as_float_val = <span class="literal">false</span>, <span class="type">bool</span> compress_val = <span class="literal">true</span>)</span><br></pre></td></tr></table></figure>

<p><code>ImageRequest</code> å›¾ç‰‡è¯·æ±‚ç±»çš„å‚æ•°ä¸º</p>
<p><code>camera_name_val</code>: ç›¸æœºç¼–å·, å¯ä»¥è¾“å…¥ <code>&quot;0&quot;</code>, <code>&quot;1&quot;</code>, <code>&quot;2&quot;</code>, <code>&quot;3&quot;</code>, <code>&quot;4&quot;</code> æˆ–è€… <code>&quot;front_center&quot;</code>, <code>&quot;front_right&quot;</code>, <code>&quot;front_left&quot;</code>, <code>&quot;fpv&quot;</code>, <code>&quot;back_center&quot;</code>.</p>
<p><code>image_type_val</code>: å›¾ç‰‡ç±»å‹, å¯æ”¯æŒçš„å›¾ç‰‡ç±»å‹æœ‰:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Scene = <span class="number">0</span>,</span><br><span class="line">DepthPlanner = <span class="number">1</span>,</span><br><span class="line">DepthPerspective = <span class="number">2</span>,</span><br><span class="line">DepthVis = <span class="number">3</span>,</span><br><span class="line">DisparityNormalized = <span class="number">4</span>,</span><br><span class="line">Segmentation = <span class="number">5</span>,</span><br><span class="line">SurfaceNormals = <span class="number">6</span>,</span><br><span class="line">Infrared = <span class="number">7</span></span><br></pre></td></tr></table></figure>

<p><code>pixels_as_float_val</code>: æ˜¯å¦ä¸ºæµ®ç‚¹å€¼, é»˜è®¤ä¸º <code>false</code>.</p>
<p><code>compress_val</code>: æ˜¯å¦æ˜¯å‹ç¼©æ•°æ®, é»˜è®¤ä¸º <code>true</code></p>
<p><strong>PS:</strong> åä¸¤ä¸ªå‚æ•°è¿™é‡Œä¼šå½±å“åˆ° opencv çš„çŸ©é˜µæˆ–è€…è§£ç å›¾ç‰‡. è¿™é‡Œé€šè¿‡å°†ä¸€ç»„å›¾åƒè¯·æ±‚ä¿¡æ¯ <code>ImageRequest</code> æ”¾å…¥å®¹å™¨ä¸­, é€šè¿‡ <code>simGetImages</code> ä¸€æ¬¡æ€§è¯·æ±‚. ä¹‹åå¯é€šè¿‡è¿­ä»£è·å–å„ä¸ªç›¸æœºçš„å›¾åƒæ•°æ®.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">getStereoAndDepthImages</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageRequest ImageRequest;</span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageResponse ImageResponse;</span><br><span class="line">    <span class="keyword">typedef</span> VehicleCameraBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//for car use</span></span><br><span class="line">    <span class="comment">//msr::airlib::CarRpcLibClient client;</span></span><br><span class="line">    msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">    msr::airlib::vector&lt;ImageRequest&gt; request = &#123;</span><br><span class="line">        <span class="comment">//png format</span></span><br><span class="line">        <span class="built_in">ImageRequest</span>(<span class="string">&quot;0&quot;</span>, ImageType::Scene),</span><br><span class="line">        <span class="comment">//uncompressed RGB array bytes</span></span><br><span class="line">        <span class="built_in">ImageRequest</span>(<span class="string">&quot;1&quot;</span>, ImageType::Scene, <span class="literal">false</span>, <span class="literal">false</span>),</span><br><span class="line">        <span class="comment">//floating point uncompressed image</span></span><br><span class="line">        <span class="built_in">ImageRequest</span>(<span class="string">&quot;1&quot;</span>, ImageType::DepthPlanner, <span class="literal">true</span>)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> vector&lt;ImageResponse&gt;&amp; response = client. <span class="built_in">simGetImages</span>(request);</span><br><span class="line">    <span class="comment">//do something with response which contains image data, pose, timestamp etc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é€šè¿‡-OpenCV-æ˜¾ç¤ºå›¾ç‰‡"><a href="#é€šè¿‡-OpenCV-æ˜¾ç¤ºå›¾ç‰‡" class="headerlink" title="é€šè¿‡ OpenCV æ˜¾ç¤ºå›¾ç‰‡"></a>é€šè¿‡ <code>OpenCV</code> æ˜¾ç¤ºå›¾ç‰‡</h2><p>è™½ç„¶è·å–åˆ°çš„å›¾ç‰‡æ˜¯ <code>uint8_t</code> ç±»å‹çš„æ•°æ®, ä½†æ˜¯æ— æ³•é€šè¿‡ç›´æ¥è½¬æ¢æˆ <code>cv::Mat</code> æ¥ä½¿ç”¨ <code>OpenCV</code> è¿›è¡Œæ“ä½œå¤„ç†. ä¸»è¦æ˜¯è·å–åˆ°çš„æ˜¯å‹ç¼©çš„å›¾ç‰‡æ•°æ®. è¿™é‡Œè¦ä½¿ç”¨ <code>cv::imdecode</code> æ¥å¯¹å›¾ç‰‡è¿›è¡Œè§£ç . å¯¹åº”çš„ä¸¤ä¸ª API ç•¥æœ‰ä¸åŒ.</p>
<p>å¦‚æœæ˜¯å‹ç¼©çš„æ•°æ®ï¼šéœ€è¦ç”¨ <code>cv::imdecode</code> æ¥è§£ç ç”Ÿæˆ <code>cv::Mat</code> çš„æ•°æ®æ ¼å¼ï¼› å¦‚æœæ˜¯éå‹ç¼©çš„æ•°æ®, å¯ä»¥ç›´æ¥è¿›è¡Œæ„é€ . å…·ä½“å¯è§ä»£ç . æ·±åº¦å›¾ç‰‡éœ€è¦å¯¹ Mat è°ƒç”¨ <code>normalize</code> å½’ä¸€åŒ–, å¦åˆ™å›¾ç‰‡å¯èƒ½å…¨ç™½.</p>
<p>å‚è€ƒèµ„æ–™:</p>
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/AirSim/issues/966">https://github.com/microsoft/AirSim/issues/966</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/issues/491">https://github.com/Microsoft/AirSim/issues/491</a></p>
<p>å®Œæ•´æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/opencv. hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;vehicles/multirotor/api/MultirotorRpcLibClient. hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ImageAPIs::getStereoAndDepthImages4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageRequest ImageRequest;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageResponse ImageResponse;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for car use</span></span><br><span class="line">  <span class="comment">// msr::airlib::CarRpcLibClient client;</span></span><br><span class="line">  msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">  msr::airlib::vector&lt;ImageRequest&gt; request = &#123;<span class="comment">// png format</span></span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;0&quot;</span>, ImageType::Scene),</span><br><span class="line">                                               <span class="comment">// uncompressed RGB array bytes</span></span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;1&quot;</span>, ImageType::Scene, <span class="literal">false</span>, <span class="literal">false</span>),</span><br><span class="line">                                               <span class="comment">// floating point uncompressed image</span></span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;1&quot;</span>, ImageType::DepthPlanner, <span class="literal">true</span>)&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="type">const</span> std::vector&lt;ImageResponse&gt;&amp; response = client. <span class="built_in">simGetImages</span>(request);</span><br><span class="line">      <span class="keyword">if</span> (response. <span class="built_in">size</span>() != request. <span class="built_in">size</span>()) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Images were not received!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å·¦ä¾§ç›¸æœº ImageRequest(&quot;0&quot;, ImageType::Scene)</span></span><br><span class="line">      <span class="comment">// é»˜è®¤å‚æ•°æ˜¯å‹ç¼©æ•°æ®, è°ƒç”¨ imdecode</span></span><br><span class="line">      cv::Mat left_mat = cv::<span class="built_in">imdecode</span>(response. <span class="built_in">at</span>(<span class="number">0</span>). image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">      cv::<span class="built_in">imshow</span>(<span class="string">&quot;left&quot;</span>, left_mat);</span><br><span class="line">      cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">      <span class="function">cv::Mat <span class="title">right_mat</span><span class="params">(response. at(<span class="number">1</span>). height, response. at(<span class="number">1</span>). width, CV_8UC3,</span></span></span><br><span class="line"><span class="params"><span class="function">                        (<span class="type">void</span>*)response. at(<span class="number">1</span>). image_data_uint8. data())</span></span>;</span><br><span class="line">      cv::<span class="built_in">imshow</span>(<span class="string">&quot;right&quot;</span>, right_mat);</span><br><span class="line">      cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ·±åº¦å›¾ç‰‡ ImageRequest(&quot;1&quot;, ImageType::DepthPlanner, true)</span></span><br><span class="line">      <span class="comment">// è¿™é‡Œéœ€è¦å¯¹ Mat è°ƒç”¨ normalize å½’ä¸€åŒ–, å¦åˆ™å›¾ç‰‡å¯èƒ½å…¨ç™½.</span></span><br><span class="line">      <span class="function">cv::Mat <span class="title">gt_depth_mat</span><span class="params">(response. at(<span class="number">2</span>). height, response. at(<span class="number">2</span>). width, CV_32FC1,</span></span></span><br><span class="line"><span class="params"><span class="function">                           (<span class="type">void</span>*)response. at(<span class="number">2</span>). image_data_float. data())</span></span>;</span><br><span class="line">      cv::<span class="built_in">normalize</span>(gt_depth_mat, gt_depth_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">      cv::<span class="built_in">imshow</span>(<span class="string">&quot;depth&quot;</span>, gt_depth_mat);</span><br><span class="line">      cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="built_in">catch</span> (rpc::timeout&amp; t) &#123;</span><br><span class="line">    <span class="comment">// will display a message like</span></span><br><span class="line">    <span class="comment">// rpc::timeout: Timeout of 50ms while calling RPC function &#x27;sleep&#x27;</span></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; t. <span class="built_in">what</span>() &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/image-20200613175100646.png" alt="image-20200613175100646"></p>
<h2 id="å¯ç”¨çš„ç›¸æœº"><a href="#å¯ç”¨çš„ç›¸æœº" class="headerlink" title="å¯ç”¨çš„ç›¸æœº"></a>å¯ç”¨çš„ç›¸æœº</h2><h3 id="è½¦"><a href="#è½¦" class="headerlink" title="è½¦"></a>è½¦</h3><p><code>API</code> å¯ä»¥é€šè¿‡ä¸€ä¸‹ç›¸æœºåç§°è°ƒç”¨: <code>&quot;front_center&quot;</code>, <code>&quot;front_right&quot;</code>, <code>&quot;front_left&quot;</code>, <code>&quot;fpv&quot;</code>, <code>&quot;back_center&quot;</code>. FPV ç›¸æœºå¤„äºé©¾é©¶å‘˜å¤´éƒ¨ä½ç½® (First Person Virsion, ç¬¬ä¸€äººç§°è§†è§’).</p>
<h3 id="é£è¡Œå™¨"><a href="#é£è¡Œå™¨" class="headerlink" title="é£è¡Œå™¨"></a>é£è¡Œå™¨</h3><p><code>API</code> å¯ä»¥é€šè¿‡ä¸€ä¸‹ç›¸æœºåç§°è°ƒç”¨: <code>front_center</code>, <code>front_right</code>, <code>front_left</code>, <code>bottom_center</code> å’Œ<code>back_center</code>.</p>
<h3 id="è®¡ç®—æœºè§†è§‰æ¨¡å¼"><a href="#è®¡ç®—æœºè§†è§‰æ¨¡å¼" class="headerlink" title="è®¡ç®—æœºè§†è§‰æ¨¡å¼"></a>è®¡ç®—æœºè§†è§‰æ¨¡å¼</h3><p>å’Œé£è¡Œå™¨çš„ä¸€è‡´.</p>
<h3 id="å‘åå…¼å®¹çš„ç›¸æœºåç§°"><a href="#å‘åå…¼å®¹çš„ç›¸æœºåç§°" class="headerlink" title="å‘åå…¼å®¹çš„ç›¸æœºåç§°"></a>å‘åå…¼å®¹çš„ç›¸æœºåç§°</h3><p>åœ¨ AirSim v1. 2 ä¹‹å‰, ç›¸æœºæ˜¯é€šè¿‡ ID æ¥æŒ‡å®šçš„. è€ƒè™‘åˆ°å‘åå…¼å®¹, ä¾ç„¶å¯ä»¥ç”¨ä¸‹ç›¸æœºçš„ ID åºå·æ¥ä»£æ›¿, é¡ºåºä¸ä¸Šè¿°åç§°ä¿æŒä¸€ç›´. æ­¤å¤–, ç›¸æœºåç§°ä¸ºç©ºå­—ç¬¦ä¸² <code>&quot;&quot;</code> ä¹Ÿæ˜¯å¯ä»¥çš„, ä¹Ÿå°±æ˜¯é»˜è®¤ç›¸æœº, é€šå¸¸ä¸º <code>&quot;0&quot;</code> .</p>
<h2 id="â€œComputer-Visionâ€-æ¨¡å¼"><a href="#â€œComputer-Visionâ€-æ¨¡å¼" class="headerlink" title="â€œComputer Visionâ€ æ¨¡å¼"></a>â€œComputer Visionâ€ æ¨¡å¼</h2><p>å¯ä»¥åœ¨ AirSim ä¸­ä½¿ç”¨ â€œComputer Virsionâ€ æ¨¡å¼. åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹, ç‰©ç†å¼•æ“è¢«ç¦ç”¨, æ²¡æœ‰è½½å…·, åªæœ‰ç›¸æœº. å¯ä»¥é€šè¿‡é”®ç›˜ç§»åŠ¨è§†è§’ (æŒ‰ F1 å¯ä»¥çœ‹å¸®åŠ©). å¯ä»¥æŒ‰ä¸‹ Record æŒ‰é’®æ¥æŒç»­ç”Ÿæˆå›¾ç‰‡. æˆ–è€…å¯ä»¥è°ƒç”¨ APIs æ¥ç§»åŠ¨ç›¸æœºå’Œè·å–å›¾ç‰‡.</p>
<p>ç¼–è¾‘ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/settings/">settings. json</a> æ–‡ä»¶å¯ä»¥æ¿€æ´»è¿™ç§æ¨¡å¼. åœ¨ç”¨æˆ·çš„ <code>Documents\AirSim</code> æ–‡ä»¶å¤¹å†… (Linux åˆ™åœ¨ <code>Documents\AirSim</code>) ç„¶åæ›´æ”¹ä¸‹åˆ—å˜é‡çš„å€¼.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;SettingsVersion&quot;</span><span class="punctuation">:</span> <span class="number">1.</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SimMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ComputerVision&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py">Python ä¾‹ç¨‹</a> ç§»åŠ¨ç›¸æœºå¹¶è·å–å›¾ç‰‡.</p>
<p>è¿™æ˜¯æ¨¡å¼æ˜¯å— <a target="_blank" rel="noopener" href="http://unrealcv.org/">UnrealCV project</a> å¯å‘çš„.</p>
<p><strong>PS</strong>:</p>
<ul>
<li>æˆ‘è¿™é‡Œæä¾›äº† C++ çš„ç‰ˆæœ¬, ç›´æ¥ç”¨ OpenCV åŠ¨æ€æ˜¾ç¤ºäº†, æ²¡æœ‰ä¿å­˜æˆå›¾ç‰‡æ ¼å¼.</li>
<li><code>settings. json</code> ç¼–è¾‘å®Œæˆå, ä¸éœ€è¦é‡å¯ UE ç¼–è¾‘å™¨, åªè¦é‡æ–°è¿è¡Œå½“å‰é¡¹ç›®å³å¯.</li>
<li>æ–¹å‘é”®è°ƒæ•´ç›¸æœºä½ç½®(å‰åå·¦å³), wasd è°ƒæ•´æœå‘.</li>
<li>æ¬§æ‹‰è§’è½¬å››å…ƒæ•°å¯ä»¥å‚è€ƒ Eigen åº“, è¿™é‡Œæ²¡å†™.</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">ImageAPIs::CVMode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">  <span class="keyword">using</span> <span class="keyword">namespace</span> msr::airlib;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageRequest ImageRequest;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageResponse ImageResponse;</span><br><span class="line">  <span class="keyword">typedef</span> ImageCaptureBase::ImageType ImageType;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// for car use</span></span><br><span class="line">  msr::airlib::MultirotorRpcLibClient client;</span><br><span class="line">  client. <span class="built_in">confirmConnection</span>();</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Press any key to set camera-0 gimble to 15-degree pitch. \n&quot;</span>;</span><br><span class="line">  std::<span class="built_in">getchar</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO client. simSetCameraOrientation();</span></span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Press any key to get camera parameters. \n&quot;</span>;</span><br><span class="line">  std::<span class="built_in">getchar</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> camera_name = <span class="number">0</span>; camera_name &lt; <span class="number">5</span>; ++camera_name) &#123;</span><br><span class="line">    CameraInfo camera_info = client. <span class="built_in">simGetCameraInfo</span>(std::<span class="built_in">to_string</span>(camera_name));</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;CameraInfo &quot;</span> &lt;&lt; camera_name &lt;&lt; <span class="string">&quot;: \n&quot;</span></span><br><span class="line">              &lt;&lt; <span class="string">&quot;Pose: &quot;</span> &lt;&lt; camera_info. pose. position. <span class="built_in">x</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; camera_info. pose. position. <span class="built_in">y</span>() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">              &lt;&lt; camera_info. pose. position. <span class="built_in">z</span>() &lt;&lt; std::endl</span><br><span class="line">              &lt;&lt; <span class="string">&quot;FOV: &quot;</span> &lt;&lt; camera_info. fov &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// get right, left and depth images. First two as png, second as float16.</span></span><br><span class="line">  msr::airlib::vector&lt;ImageRequest&gt; request = &#123;<span class="built_in">ImageRequest</span>(<span class="string">&quot;0&quot;</span>, ImageType::DepthVis),</span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;1&quot;</span>, ImageType::DepthPerspective, <span class="literal">true</span>),</span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;2&quot;</span>, ImageType::Segmentation),</span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;3&quot;</span>, ImageType::Scene),</span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;4&quot;</span>, ImageType::DisparityNormalized),</span><br><span class="line">                                               <span class="built_in">ImageRequest</span>(<span class="string">&quot;4&quot;</span>, ImageType::SurfaceNormals)&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">/* TODO</span></span><br><span class="line"><span class="comment">   client. simSetVehiclePose();</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"></span><br><span class="line">    <span class="type">const</span> msr::airlib::vector&lt;ImageResponse&gt;&amp; responses = client. <span class="built_in">simGetImages</span>(request);</span><br><span class="line">    <span class="comment">// do something with response which contains image data, pose, timestamp etc</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; responses. <span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      <span class="function">std::string <span class="title">strid</span><span class="params">(std::to_string(i))</span></span>;</span><br><span class="line">      <span class="type">const</span> <span class="keyword">auto</span>&amp; response = responses. <span class="built_in">at</span>(i);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (response. pixels_as_float) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Type &quot;</span> &lt;&lt; <span class="built_in">int</span>(response. image_type) &lt;&lt; <span class="string">&quot;, size &quot;</span> &lt;&lt; response. image_data_float. <span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;, pos &quot;</span></span><br><span class="line">                  &lt;&lt; response. camera_position. <span class="built_in">x</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; response. camera_position. <span class="built_in">y</span>() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; response. camera_position. <span class="built_in">z</span>() &lt;&lt; std::endl;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Type &quot;</span> &lt;&lt; <span class="built_in">int</span>(response. image_type) &lt;&lt; <span class="string">&quot;, size &quot;</span> &lt;&lt; response. image_data_uint8. <span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;, pos &quot;</span></span><br><span class="line">                  &lt;&lt; response. camera_position. <span class="built_in">x</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; response. camera_position. <span class="built_in">y</span>() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                  &lt;&lt; response. camera_position. <span class="built_in">z</span>() &lt;&lt; std::endl;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">switch</span> (response. image_type) &#123;</span><br><span class="line">        <span class="keyword">case</span> ImageType::Scene:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:Scene-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat <span class="built_in">img_mat</span>(response. height, response. width, CV_8UC3, (<span class="type">void</span>*)response. image_data_uint8. <span class="built_in">data</span>());</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:Scene-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthPlanner:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DepthPlanner-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat <span class="built_in">img_mat</span>(response. height, response. width, CV_32FC1, (<span class="type">void</span>*)response. image_data_float. <span class="built_in">data</span>());</span><br><span class="line">            cv::<span class="built_in">normalize</span>(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DepthPlanner-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthPerspective:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DepthPerspective-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            <span class="comment">// cv::Mat img_mat = cv::imdecode(response. image_data_float, cv::IMREAD_GRAYSCALE);</span></span><br><span class="line">            cv::Mat <span class="built_in">img_mat</span>(response. height, response. width, CV_32FC1, (<span class="type">void</span>*)response. image_data_float. <span class="built_in">data</span>());</span><br><span class="line">            cv::<span class="built_in">normalize</span>(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DepthPerspective-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DepthVis:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_GRAYSCALE);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DepthVis-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::DisparityNormalized:</span><br><span class="line">          <span class="keyword">if</span> (response. pixels_as_float) &#123;</span><br><span class="line">            <span class="function">cv::Mat <span class="title">img_mat</span><span class="params">(response. height, response. width, CV_32FC1, (<span class="type">void</span>*)response. image_data_float. data())</span></span>;</span><br><span class="line">            cv::<span class="built_in">normalize</span>(img_mat, img_mat, <span class="number">1</span>, <span class="number">0</span>, cv::NORM_MINMAX);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:DisparityNormalized-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::Segmentation:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:Segmentation-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat <span class="built_in">img_mat</span>(response. height, response. width, CV_8UC3, (<span class="type">void</span>*)response. image_data_uint8. <span class="built_in">data</span>());</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:Segmentation-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> ImageType::SurfaceNormals:</span><br><span class="line">          <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; response.compress) &#123;</span><br><span class="line">            cv::Mat img_mat = cv::<span class="built_in">imdecode</span>(response. image_data_uint8, cv::IMREAD_UNCHANGED);</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:SurfaceNormals-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!response. pixels_as_float &amp;&amp; !response.compress) &#123;</span><br><span class="line">            cv::Mat <span class="built_in">img_mat</span>(response. height, response. width, CV_8UC3, (<span class="type">void</span>*)response. image_data_uint8. <span class="built_in">data</span>());</span><br><span class="line">            cv::<span class="built_in">imshow</span>(response. camera_name + <span class="string">&quot;:SurfaceNormals-&quot;</span> + strid, img_mat);</span><br><span class="line">            cv::<span class="built_in">waitKey</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">auto</span> pose = client. <span class="built_in">simGetVehiclePose</span>();</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;Vehicle Pose: &quot;</span> &lt;&lt; pose. position. <span class="built_in">x</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pose. position. <span class="built_in">y</span>() &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pose. position. <span class="built_in">y</span>()</span><br><span class="line">                &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/image-20200613184934655.png" alt="image-20200613184934655"></p>
<h3 id="åœ¨-Computer-Vision-æ¨¡å¼ä¸‹è®¾ç½®ä½å§¿"><a href="#åœ¨-Computer-Vision-æ¨¡å¼ä¸‹è®¾ç½®ä½å§¿" class="headerlink" title="åœ¨ Computer Vision æ¨¡å¼ä¸‹è®¾ç½®ä½å§¿"></a>åœ¨ Computer Vision æ¨¡å¼ä¸‹è®¾ç½®ä½å§¿</h3><p>ä¸ºäº†åœ¨ç¯å¢ƒä¸­é€šè¿‡ <code>APIs</code> ç§»åŠ¨, å¯ä»¥ç”¨è¿‡ <code>simSetVehiclePose</code> API. è¿™ä¸ª API ä¼ å…¥ä½ç½®å’Œå§¿æ€å‚æ•°, å°†ä¸å¯è§çš„è½½å…·è®¾ç½®åœ¨ <code>front-center</code> ç›¸æœºæ‰€å¤„çš„ä½ç½®. å…¶ä»–çš„ç›¸æœºä¿æŒç›¸å¯¹çš„ä½ç½®ç§»åŠ¨. å¦‚æœä¸æƒ³æ”¹å˜ä½ç½®æˆ–è€…å§¿æ€, åªéœ€è¦å°†ä½ç½®å’Œå§¿æ€è®¾ç½®ä¸º nan çš„æµ®ç‚¹æ•°. <code>simGetVehiclePose</code> å¯ä»¥è·å–å½“å‰ä½å§¿, ä½ å¯ä»¥ç”¨ <code>simGetGroundTruthKinematics</code> æ¥è·å– quantities kinematics quantities for the movement (ä¸å¤ªæ˜ç™½è¿™æ„æ€). è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ— è½½å…·ç‰¹å®šçš„ APIs ä¹Ÿæ˜¯å¯ç”¨, æ¯”å¦‚ åˆ†å‰² APIs, ç¢°æ’ APIs, ç›¸æœº APIs.</p>
<h2 id="ç›¸æœº-APIs"><a href="#ç›¸æœº-APIs" class="headerlink" title="ç›¸æœº APIs"></a>ç›¸æœº APIs</h2><p><code>simGetCameraInfo</code> è¿”å›æŒ‡å®šç›¸æœºçš„ä½å§¿ (ä¸–ç•Œåœºæ™¯, NED åæ ‡ç³», å›½é™…æ ‡å‡†å•ä½åˆ¶) å’Œ FOV (è§’åº¦) . å¯å‚è€ƒä¾‹ç¨‹ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py">example usage</a>.</p>
<p><code>simSetCameraOrientation</code> è®¾ç½®æŒ‡å®šç›¸æœºåœ¨ NED åæ ‡ç³»ä¸‹çš„ä½å§¿(å››å…ƒæ•°). å‡½æ•° <code>airsim. to_quaternion()</code> ç”¨æ¥å°†ä¿¯ä»°, ç¿»è½¬, åèˆªè§’åº¦è½¬åŒ–ä¸ºå››å…ƒæ•°, ä¸¾ä¸ªä¾‹å­, è®¾ç½®ç›¸æœº - 0 å€¾æ–œè§’åº¦ä¸º 15 åº¦, å¯ä»¥ç”¨ (<strong>PS</strong>: è¿™ä¸ªæ˜¯ Python ç‰ˆæœ¬, C++ æ²¡æ‰¾åˆ°, å¯ä»¥è‡ªå·±ç”¨ Eigen åº“å®ç°) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">client. simSetCameraOrientation(<span class="number">0</span>, airsim. to_quaternion(<span class="number">0.</span> <span class="number">261799</span>, <span class="number">0</span>, <span class="number">0</span>)); <span class="comment">#radians</span></span><br></pre></td></tr></table></figure>

<h3 id="Gimbal"><a href="#Gimbal" class="headerlink" title="Gimbal"></a>Gimbal</h3><p>å¯ä»¥ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/settings/#gimbal">using settings</a> å°†ä»»æ„ç›¸æœºè®¾ç½®ä¸ºä¿¯ä»°, ç¿»è½¬, åèˆªè§’åº¦.</p>
<p>è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/cv_mode.py">example usage</a>.</p>
<h2 id="ä¿®æ”¹åˆ†è¾¨ç‡å’Œç›¸æœºå‚æ•°"><a href="#ä¿®æ”¹åˆ†è¾¨ç‡å’Œç›¸æœºå‚æ•°" class="headerlink" title="ä¿®æ”¹åˆ†è¾¨ç‡å’Œç›¸æœºå‚æ•°"></a>ä¿®æ”¹åˆ†è¾¨ç‡å’Œç›¸æœºå‚æ•°</h2><p>é€šè¿‡ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/settings/">settings. json</a> å¯ä»¥ä¿®æ”¹åˆ†è¾¨ç‡å’Œè§†åœºè§’. ä¸¾ä¸ªä¾‹å­, ä¸‹è¿° settings. json çš„é¢å¤–éƒ¨åˆ†è®¾ç½®äº†æ•æ‰åœºæ™¯çš„å‚æ•°, å¹¶ç”¨å‰è¿°çš„ â€œComputer Versionâ€ æ¨¡å¼. å¦‚æœä½ çœç•¥äº†ä»»ä½•è®¾ç½®, ä¸‹è¿°é»˜è®¤å‚æ•°å°†ä¼šè¢«ä½¿ç”¨. æ›´å¤šè®¾ç½®å‚è§ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/settings/">settings doc</a>. å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ç«‹ä½“ç›¸æœº, å·¦å³ä¸¤ä¸ªç›¸æœºçš„å›ºå®šè·ç¦»æ˜¯ 25 cm.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;SettingsVersion&quot;</span><span class="punctuation">:</span> <span class="number">1.</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;CameraDefaults&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;CaptureSettings&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;ImageType&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Width&quot;</span><span class="punctuation">:</span> <span class="number">256</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;Height&quot;</span><span class="punctuation">:</span> <span class="number">144</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;FOV_Degrees&quot;</span><span class="punctuation">:</span> <span class="number">90</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;AutoExposureSpeed&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;MotionBlurAmount&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;SimMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ComputerVision&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="åœ¨ä¸åŒçš„å›¾åƒç±»å‹åƒç´ å€¼è¡¨ç¤ºä»€ä¹ˆ"><a href="#åœ¨ä¸åŒçš„å›¾åƒç±»å‹åƒç´ å€¼è¡¨ç¤ºä»€ä¹ˆ" class="headerlink" title="åœ¨ä¸åŒçš„å›¾åƒç±»å‹åƒç´ å€¼è¡¨ç¤ºä»€ä¹ˆ"></a>åœ¨ä¸åŒçš„å›¾åƒç±»å‹åƒç´ å€¼è¡¨ç¤ºä»€ä¹ˆ</h2><h3 id="å¯ç”¨çš„å›¾åƒç±»å‹"><a href="#å¯ç”¨çš„å›¾åƒç±»å‹" class="headerlink" title="å¯ç”¨çš„å›¾åƒç±»å‹"></a>å¯ç”¨çš„å›¾åƒç±»å‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Scene = <span class="number">0</span>,</span><br><span class="line">DepthPlanner = <span class="number">1</span>,</span><br><span class="line">DepthPerspective = <span class="number">2</span>,</span><br><span class="line">DepthVis = <span class="number">3</span>,</span><br><span class="line">DisparityNormalized = <span class="number">4</span>,</span><br><span class="line">Segmentation = <span class="number">5</span>,</span><br><span class="line">SurfaceNormals = <span class="number">6</span>,</span><br><span class="line">Infrared = <span class="number">7</span></span><br></pre></td></tr></table></figure>

<h3 id="DepthPlanner-and-DepthPerspective"><a href="#DepthPlanner-and-DepthPerspective" class="headerlink" title="DepthPlanner and DepthPerspective"></a>DepthPlanner and DepthPerspective</h3><p>é€šå¸¸ä½ å¸Œæœ›åœ¨æ¥æ”¶åˆ° float è¡¨ç¤ºçš„æ·±åº¦å›¾åƒ ( å³åœ¨<code>ImageRequest</code> å°†è®¾ç½® <code>pixels_as_float = true</code>) ç„¶åæŒ‡å®š <code>ImageType = DepthPlanner</code> æˆ–è€… <code>ImageType = DepthPerspective</code> . å¯¹äº <code>ImageType = DepthPlanner</code>, å°†è·å¾—è·å¾—æ·±åº¦, å³æ‰€æœ‰ä¸ç›¸æœºå¤„äºç›¸åŒè·ç¦»çš„ç‚¹å…·æœ‰ç›¸åŒçš„æ·±åº¦. å¯¹äº <code>ImageType = DepthPerspective</code>, é€šè¿‡å°„å‘åƒç´ ç‚¹çš„å°„çº¿æ¥è·å–æ·±åº¦. å–å†³ä¸ä½¿ç”¨çš„æ¡ˆä¾‹, å¹³è¡Œæ·±åº¦æˆ–è€…é€è§†æ·±åº¦å¯èƒ½æ˜¯æ‰€éœ€çš„çœŸæ­£å›¾åƒ. ä¸¾ä¸ªä¾‹å­, ä½ å¯èƒ½å¯¹ ROS åŒ…å‘å¸ƒé€è§†æ·±åº¦, ä¾‹å¦‚ <code>depth_image_proc</code> æ¥ç”Ÿæˆç‚¹äº‘. æˆ–è€…å¹³è¡Œæ·±åº¦å¯èƒ½é€šè¿‡ç«‹ä½“è§†è§‰ç®—æ³•, ä¾‹å¦‚ SGM, ç”¨æ¥ä¼°è®¡æ·±åº¦å›¾åƒçš„ç”Ÿæˆ.</p>
<h3 id="DepthVis"><a href="#DepthVis" class="headerlink" title="DepthVis"></a>DepthVis</h3><p>å½“åœ¨ <code>ImageRequest</code> æŒ‡å®š <code>ImageType = DepthVis</code>, å°†è·å¾—ä¸€å‰¯æœ‰åŠ©äºå¯è§†åŒ–æ·±åº¦çš„å›¾åƒ. åœ¨è¿™ç§è¯·è·¨ä¸‹, æ¯ä¸ªåƒç´ å€¼æ˜¯ç±³å€¼çš„æ ¹æ®ç›¸æœºå¹³é¢ä»ç™½åˆ°é»‘çš„æ’å€¼. çº¯ç™½çš„åƒç´ æ„å‘³ç€æ·±åº¦è¶…è¿‡ 100 m, çº¯é»‘æ„å‘³ç€æ·±åº¦ä¸º 0 m.</p>
<h3 id="DisparityNormalized"><a href="#DisparityNormalized" class="headerlink" title="DisparityNormalized"></a>DisparityNormalized</h3><p>é€šå¸¸ä½ å¸Œæœ›åœ¨æ¥æ”¶åˆ° float è¡¨ç¤ºçš„æ·±åº¦å›¾åƒ ( å³åœ¨<code>ImageRequest</code> è®¾ç½® <code>pixels_as_float = true</code> <code>ImageType = DisparityNormalized</code> ) . è¿™ç§æƒ…å†µä¸‹, æ¯ä¸ªåƒç´ å€¼æ˜¯ <code>(Xl - Xr)/Xmax</code>, å³è¢«å½’ä¸€åŒ–ä¸º 0 åˆ° 1 ä¹‹é—´çš„å€¼.</p>
<h3 id="Segmentation"><a href="#Segmentation" class="headerlink" title="Segmentation"></a>Segmentation</h3><p>å½“åœ¨ <code>ImageRequest</code> æŒ‡å®š <code>ImageType = Segmentation</code> , å°†è·å–åˆ°çœŸå®åœºæ™¯çš„åˆ†å‰²å›¾. åœ¨å¯åŠ¨æ—¶, AirSim ç»™ç¯å¢ƒä¸­æ¯å—ç½‘æ ¼åˆ†é… 0 åˆ° 255 çš„å€¼. è¿™äº›å€¼å°†æ˜ å°„ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/Unreal//Plugins/AirSim/Content/HUDAssets/seg_color_pallet.png">the pallet</a> ä¸­æŒ‡å®šçš„é¢œè‰². æ¯ä¸ªå¯¹è±¡çš„ ID å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/seg_rgbs.txt">this file</a> æ‰¾åˆ°.</p>
<p>ä½ å¯ä»¥é€šè¿‡ APIs ç»™æŒ‡å®šçš„ç½‘æ ¼åˆ†é…æŒ‡å®šçš„å€¼ (èŒƒå›´é™åˆ¶åœ¨ 0-255) . ä¸¾ä¸ªä¾‹å­, ä¸‹è¿°çš„ Python (PS: C++ ä»£ç ç›¸åŒ) ä»£ç ç»™ä¸€ä¸ªå¯¹è±¡ ID ä¸º â€Groundâ€œ åœ¨ Blocks ç¯å¢ƒä¸­çš„å€¼ä¸º 20, æ‰€ä»¥æ”¹å˜äº†è¯¥å¯¹è±¡åœ¨åˆ†å‰²è§†å›¾ä¸­çš„é¢œè‰²:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success = client. simSetSegmentationObjectID(<span class="string">&quot;Ground&quot;</span>, <span class="number">20</span>);</span><br></pre></td></tr></table></figure>

<p>è¿”å›çš„å¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦æ‰¾åˆ°è¯¥ç½‘æ ¼.</p>
<p>ä¸»è¦, å…¸å‹çš„ Unreal ç¯å¢ƒä¸­, åƒ Blocks, é€šå¸¸æœ‰å¾ˆå¤šå…¶ä»–æœ‰ç›¸åŒå¯¹è±¡ç»„æˆçš„ç½‘æ ¼, ä¸¾ä¸ªä¾‹å­, â€œGround_2â€, â€œGround_3â€ ç­‰ç­‰. å› ä¸ºå¯¹æ‰€æœ‰ç½‘æ ¼è®¾ç½®å¯¹è±¡ ID æ˜¯å¾ˆå†—æ‚çš„, AirSim ä¹Ÿæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼. ä¸¾ä¸ªä¾‹å­, ä»¥ä¸‹åªç”¨äº†ä¸€è¡Œä»£ç è®¾ç½®äº†åç§°ä»¥ â€groundâ€œ å¼€å¤´çš„æ‰€æœ‰ç½‘æ ¼ä¸º 21 (å¿½ç•¥å¤§å°å†™) :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">success = client. simSetSegmentationObjectID(<span class="string">&quot;ground[\w]*&quot;</span>, <span class="number">21</span>, <span class="literal">True</span>);</span><br></pre></td></tr></table></figure>

<p>å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªç½‘æ ¼è¢«æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…, åˆ™è¿”å› true.</p>
<p>å»ºè®®é€šè¿‡è¿™ä¸ª API æ¥è¯·æ±‚æœªå‹ç¼©çš„åˆ†å‰²å›¾åƒ, ç¡®ä¿è·å–åˆ°ç²¾ç¡®çš„ RGB å€¼:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">responses = client. simGetImages([ImageRequest(<span class="number">0</span>, AirSimImageType. Segmentation, <span class="literal">False</span>, <span class="literal">False</span>)])</span><br><span class="line">img1d = np. fromstring(response. image_data_uint8, dtype=np. uint8) <span class="comment">#get numpy array</span></span><br><span class="line">img_rgb = img1d. reshape(response. height, response. width, <span class="number">3</span>) <span class="comment">#reshape array to 3 channel image array H X W X 3</span></span><br><span class="line">img_rgb = np. flipud(img_rgb) <span class="comment">#original image is fliped vertically</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#find unique colors</span></span><br><span class="line"><span class="built_in">print</span>(np. unique(img_rgb[:, :, <span class="number">0</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#red</span></span><br><span class="line"><span class="built_in">print</span>(np. unique(img_rgb[:, :, <span class="number">1</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#green</span></span><br><span class="line"><span class="built_in">print</span>(np. unique(img_rgb[:, :, <span class="number">2</span>], return_counts=<span class="literal">True</span>)) <span class="comment">#blue</span></span><br></pre></td></tr></table></figure>

<p>å®Œæ•´å¯è¿è¡Œçš„ç¨‹åºè§ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/PythonClient//computer_vision/segmentation.py">segmentation. py</a>.</p>
<h4 id="Unsetting-object-ID"><a href="#Unsetting-object-ID" class="headerlink" title="Unsetting object ID"></a>Unsetting object ID</h4><p>å¦‚æœä¸æƒ³åœ¨åˆ†å‰²å›¾åƒä¸­æ˜¾ç¤ºå¯¹è±¡, å¯ä»¥è®¾ç½®å¯¹è±¡ ID ä¸º -1.</p>
<h4 id="å¦‚ä½•æ‰¾åˆ°ç½‘æ ¼çš„åå­—"><a href="#å¦‚ä½•æ‰¾åˆ°ç½‘æ ¼çš„åå­—" class="headerlink" title="å¦‚ä½•æ‰¾åˆ°ç½‘æ ¼çš„åå­—"></a>å¦‚ä½•æ‰¾åˆ°ç½‘æ ¼çš„åå­—</h4><p>ä¸ºäº†è·å–çœŸå®çš„åˆ†å‰²å›¾, ä½ éœ€è¦çŸ¥é“åœ¨ Unreal ç¯å¢ƒä¸­çš„ç½‘æ ¼åç§°. æ‰“å¼€ UE ç¼–è¾‘å™¨ä¸­çš„ Unreal ç¯å¢ƒ, ç„¶ååœ¨ä¸–ç•Œå¤§çº²è§†å›¾ (World Outliner) ä¸­æ‰¾åˆ°æ„Ÿå…´è¶£çš„ç½‘æ ¼. ä¸¾ä¸ªä¾‹å­, ä¸‹è¿°å›¾ç‰‡æˆ‘ä»¬å¯ä»¥åœ¨å³ä¾§ Blocks ç¯å¢ƒé¢æ¿ä¸­çœ‹åˆ° ground çš„ç½‘æ ¼åç§°:</p>
<p><img src="https://microsoft.github.io/AirSim/images/unreal_editor_blocks.png" alt="record screenshot"></p>
<p>å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•åœ¨ Unreal ç¼–è¾‘å™¨ä¸­æ‰“å¼€ Unreal ç¯å¢ƒ, å¯ä»¥å‚è€ƒä¸‹åˆ—æ•™ç¨‹ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/build_windows/">building from source</a>.</p>
<p>ä¸€æ—¦ä½ å†³å®šä½ æ„Ÿå…´è¶£çš„ç½‘æ ¼, å‡ ä¸‹å®ƒä»¬çš„åç§°, ç„¶åé€šè¿‡ä¸Šè¿°çš„ API æ¥è®¾ç½®å®ƒä»¬çš„ object IDs. è¿™é‡Œæœ‰ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/settings/#segmentation-settings">few settings</a> æ¥æ”¹å˜ç”Ÿæˆ object ID çš„è¡Œä¸º.</p>
<h4 id="ä¿®æ”¹-Object-IDs-çš„é¢œè‰²"><a href="#ä¿®æ”¹-Object-IDs-çš„é¢œè‰²" class="headerlink" title="ä¿®æ”¹ Object IDs çš„é¢œè‰²"></a>ä¿®æ”¹ Object IDs çš„é¢œè‰²</h4><p>ç›®å‰æ¯ä¸ªå¯¹è±¡ ID éƒ½åœ¨ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/Unreal//Plugins/AirSim/Content/HUDAssets/seg_color_pallet.png">this pallet</a> è¢«å›ºå®š. æˆ‘ä»¬å°†å¾ˆå¿«å¢åŠ æ”¹å˜ object IDs é¢œè‰²çš„åŠŸèƒ½. åŒæ—¶, ä½ å°†å¯ä»¥åœ¨ä½ å–œæ¬¢çš„å›¾åƒç¼–è¾‘å™¨ä¸­æ‰“å¼€åˆ†å‰²å›¾, ç„¶åè·å–ä½ æ„Ÿå…´è¶£çš„ RGB å€¼.</p>
<h4 id="Startup-Object-IDs"><a href="#Startup-Object-IDs" class="headerlink" title="Startup Object IDs"></a>Startup Object IDs</h4><p>å¼€å§‹æ—¶, AirSim ç»™èƒ½åœ¨ç¯å¢ƒä¸­çš„<code>UStaticMeshComponent</code> æˆ–è€… <code>ALandscapeProxy</code> ç±»å‹çš„æ¯ä¸ªå¯¹è±¡åˆ†é…äº† object id. ç„¶åä½¿ç”¨ç½‘æ ¼åç§°æˆ–è€…æœ¬èº«çš„åç§° (å–å†³äºè®¾ç½®), è½¬æ¢ä¸ºå°å†™, ç§»é™¤æ‰€æœ‰å°äº ASCII 97 çš„å­—ç¬¦ä»¥ç§»é™¤æ•°å­—å’Œä¸€äº›æ ‡ç‚¹, å¯¹æ‰€æœ‰å­—ç¬¦æ±‚å’Œå¹¶é™¤ä»¥ 255 å–æ¨¡æ¥ç”Ÿæˆ object id. æ¢å¥è¯è¯´, æ‰€å…·æœ‰ç›¸åŒå­—ç¬¦çš„å¯¹è±¡å°†æœ‰ç›¸åŒçš„ object ID. è¿™ä¸ªå¯å‘å¯¹äºå¾ˆå¤š Unreal ç¯å¢ƒå¾ˆç®€å•ä¹Ÿæœ‰æœ‰æ•ˆ, ä½†æ˜¯å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„. è¿™ç§æƒ…å†µä¸‹, è¯·ç”¨ä¸Šé¢çš„ APIs æ¥ä¿®æ”¹ object IDs ä¸ºä½ æƒ³è¦çš„å€¼. è¿™é‡Œå¯ä»¥è®¾ç½®å¯èƒ½ä¿®æ”¹è¿™äº›è¡¨ç° r.</p>
<h4 id="ä¸ºç½‘æ ¼è·å–-Object-ID"><a href="#ä¸ºç½‘æ ¼è·å–-Object-ID" class="headerlink" title="ä¸ºç½‘æ ¼è·å– Object ID"></a>ä¸ºç½‘æ ¼è·å– Object ID</h4><p><code>simGetSegmentationObjectID</code> API å…è®¸ä½ è·å–ä¸€ä¸ªæŒ‡å®šç½‘æ ¼åç§°çš„ object ID.</p>
<h3 id="Infrared"><a href="#Infrared" class="headerlink" title="Infrared"></a>Infrared</h3><p>ç›®å‰, è¿™åªæ˜¯å°† object ID æ˜ å°„ä¸º 0-255 ç°åº¦åŸŸçš„æ˜ å°„. æ‰€ä»¥å¾ˆå¤š object ID 42 çš„ç½‘æ ¼å‡å·² (42, 42, 42) çš„é¢œè‰²æ˜¾ç¤º. è¯·å‚è€ƒ <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/image_apis/#segmentation">segmentation section</a> è·å–å¦‚ä½•è®¾ç½® object IDs æ›´å¤šçš„ç»†èŠ‚. é€šå¸¸, å™ªå£°è®¾ç½®å¯ä»¥è¢«è¿ç”¨åœ¨è¿™ç§å›¾åƒç±»å‹, ä»¥è·å–ç»†å¾®çš„æ›´åŠ çœŸå®æ•ˆæœ. æˆ‘ä»¬ä¾ç„¶åœ¨å¢åŠ å…¶ä»–çš„ infrared artifacts æ–¹é¢å±•å¼€å·¥ä½œ, ä¹Ÿæ¬¢è¿ä»»ä½•çš„ contributions .</p>
<h2 id="ä¾‹ç¨‹ä»£ç "><a href="#ä¾‹ç¨‹ä»£ç " class="headerlink" title="ä¾‹ç¨‹ä»£ç "></a>ä¾‹ç¨‹ä»£ç </h2><p>è®¾ç½®è½½å…·åˆ°ä»»æ„æ–¹ä½å’Œè·å–å›¾ç‰‡çš„ä»£ç å¯ä»¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/Microsoft/AirSim/tree/master/Examples/DataCollection/StereoImageGenerator.hpp">GenerateImageGenerator. hpp</a> æ‰¾åˆ°. è¿™ä¸ªä¾‹ç¨‹ç”ŸæˆæŒ‡å®šæ•°é‡çš„ç«‹ä½“å›¾åƒå’Œåœ°é¢å®å†µè§†å·®å›¾åƒ, å¹¶ä¿å­˜ä¸º <a target="_blank" rel="noopener" href="https://microsoft.github.io/AirSim/pfm/">pfm format</a>.</p>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css?v=1.0.0"><script type="text/javascript" src="/js/donate.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><a class="pos-f tr3" id="github" href="https://github.com/Kaiyuan/donate-page" target="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="WeChat" qr="/img/wechatpay.jpg"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>æœ¬æ–‡æ ‡é¢˜ï¼š</span>è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (5) - å›¾ç‰‡ APIs - C++</p><p><span>æ–‡ç« ä½œè€…ï¼š</span>xwnb</p><p><span>å‘å¸ƒæ—¶é—´ï¼š</span>2020-06-22</p><p><span>æœ€åæ›´æ–°ï¼š</span>2022-10-16</p><p><span>åŸå§‹é“¾æ¥ï¼š</span><a href="/posts/3314168402/">https://xwnb.github.io/posts/3314168402/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://xwnb.github.io/posts/3314168402/"></i></span></p><p><span>ç‰ˆæƒå£°æ˜ï¼š</span>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ BY-NC-SA è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼å¹¶ä¿ç•™æœ¬å£°æ˜ã€‚æ„Ÿè°¢æ‚¨çš„é˜…è¯»å’Œæ”¯æŒï¼</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://xwnb.github.io/posts/3314168402/" data-id="cl9bap3qt00d92ro75c0ufm5a" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAABwklEQVR42u3aQW7DMAwEQP//0+4D0thL0WKNYnQKDEOa5ECI3BxHvM6PlT+/3u3YsXBxcdvc83J9O+DzsOsn1zskBlxc3Hnut4pR3Topc9f739hwcXFfyb2+puQ4XFzc/8q9Pv51hQwXF7fITS4rSatTbXg29mq4uLgNbj6l3Pd5y3wXFxd3iXsWV972dEYqX0/HxcUd4eYFJb925K1U9VxcXNx5bl6engUlxa7wy+Hi4j7ErQ4xk1FI3rlUg1tcXNzd3H5JqgYq+cXol58AFxd3kNsPWTvNT37BwsXFneQWRhJxuFKNbKNmDBcXd4SbRCM5KL+4LBYyXFzcEW41Os2HnsnopBzT4uLijnDzIUhetqoD08W6i4uLO8LN4421yKQTuB55tcPFxd3AzUORakxSfbPQq+Hi4m7jro1N12LXaruFi4v7t9zOXyWe+to37+Di4m7mnsXVCUjWRi24uLjz3HytjU5a44+lCxYuLu5T3E7xSq5Ka5HqTfODi4s7ws0LTXXMUejDqr0aLi7uy7jVJ53gFhcX9/3ctRh1Ede/4uDi4ja4SYmp/iEj3zNppXBxcSe55VLSfrOKxsXFHeT+AAe6cbCFPBiAAAAAAElFTkSuQmCC">åˆ†äº«</a><div class="tags"><a href="/tags/è‡ªåŠ¨é©¾é©¶"><i class="fa fa-tag">è‡ªåŠ¨é©¾é©¶</i></a><a href="/tags/AirSim"><i class="fa fa-tag">AirSim</i></a></div><div class="post-nav"><a class="pre" href="/posts/1270863220/">è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (6) - è®¾ç½®</a><a class="next" href="/posts/1307933338/">è‡ªåŠ¨é©¾é©¶ä»¿çœŸ - AirSim (4) - æ ¸å¿ƒ APIs - C++</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://xwnb.github.io"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="å…³äº"><img src="/img/avatar.jpg"/></a><p>Stay Angry, Stay Foolish.</p><a class="info-icon" href="https://juejin.cn/user/435824491237181" title="æ˜é‡‘" target="_blank" style="margin-inline:5px"> <i class="fa fa-external-link-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/xwnb" title="GitHub" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> åˆ†ç±»</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ROS%E5%AD%A6%E4%B9%A0/">ROSå­¦ä¹ </a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SEI-CERT-C/">SEI CERT C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">å¾®ä¿¡å°ç¨‹åºå¼€å‘</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">è‡ªåŠ¨é©¾é©¶</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">è·¯å¾„è§„åˆ’</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> æ ‡ç­¾</i></div><div class="tagcloud"><a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/wechat-dev/" style="font-size: 15px;">wechat-dev</a> <a href="/tags/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" style="font-size: 15px;">è·¯å¾„è§„åˆ’</a> <a href="/tags/motion-planning/" style="font-size: 15px;">motion planning</a> <a href="/tags/RRT/" style="font-size: 15px;">RRT</a> <a href="/tags/A/" style="font-size: 15px;">A*</a> <a href="/tags/LPA/" style="font-size: 15px;">LPA*</a> <a href="/tags/RRT-Connect/" style="font-size: 15px;">RRT_Connect</a> <a href="/tags/RRT/" style="font-size: 15px;">RRT*</a> <a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 15px;">è‡ªåŠ¨é©¾é©¶</a> <a href="/tags/AirSim/" style="font-size: 15px;">AirSim</a> <a href="/tags/SEI-CERT-C/" style="font-size: 15px;">SEI CERT C++</a> <a href="/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 15px;">ç¼–ç è§„èŒƒ</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 15px;">ç¿»è¯‘</a> <a href="/tags/CERT-Containers/" style="font-size: 15px;">CERT Containers</a> <a href="/tags/Input-Output/" style="font-size: 15px;">Input Output</a> <a href="/tags/Memory-Management/" style="font-size: 15px;">Memory Management</a> <a href="/tags/Characters-and-Strings/" style="font-size: 15px;">Characters and Strings</a> <a href="/tags/STR/" style="font-size: 15px;">STR</a> <a href="/tags/Integers/" style="font-size: 15px;">Integers</a> <a href="/tags/INT/" style="font-size: 15px;">INT</a> <a href="/tags/Object-Oriented-Programming/" style="font-size: 15px;">Object Oriented Programming</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/ROS/" style="font-size: 15px;">ROS</a> <a href="/tags/xacro/" style="font-size: 15px;">xacro</a> <a href="/tags/controller-manager/" style="font-size: 15px;">controller_manager</a> <a href="/tags/gazebo/" style="font-size: 15px;">gazebo</a> <a href="/tags/controller-manager/" style="font-size: 15px;">controller-manager</a> <a href="/tags/ur5/" style="font-size: 15px;">ur5</a> <a href="/tags/roslaunch/" style="font-size: 15px;">roslaunch</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> æœ€è¿‘æ–‡ç« </i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/2113816124/">FIO51-CPP. å…³é—­ä¸å†éœ€è¦çš„æ–‡ä»¶</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2518610003/">OPP-CPP58. æ‹·è´æ“ä½œç»ä¸èƒ½æ”¹å˜æºå¯¹è±¡</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/294055068/">OPP-CPP57. ä¼˜å…ˆä½¿ç”¨ç‰¹å®šçš„æˆå‘˜å‡½æ•°å’Œé‡è½½çš„è¿ç®—ç¬¦è€Œä¸æ˜¯Cæ ‡å‡†åº“å‡½æ•°</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3554254475/">OOP56-CPP. å°Šé‡æ›¿æ¢handlerçš„è¦æ±‚</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3554254475/">OOP55-CPP. ä¸è¦ä½¿ç”¨æˆå‘˜æŒ‡é’ˆè¿ç®—ç¬¦æ¥è®¿é—®ä¸å­˜åœ¨çš„æˆå‘˜</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/144696281/">OOP54-CPP. ä¼˜é›…åœ°å¤„ç†è‡ªæˆ‘æ‹·è´èµ‹å€¼</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3904355907/">OOP53-CPP. æŒ‰ç…§è§„èŒƒé¡ºåºç¼–å†™æ„é€ å‡½æ•°çš„æˆå‘˜åˆå§‹åŒ–</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/4027020077/">OOP52-CPP. ä¸è¦åˆ é™¤ä¸€ä¸ªæ— è™šææ„çš„å¤šæ€å¯¹è±¡</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1084595410/">OOP51-CPP-ä¸è¦åˆ‡åˆ†æ´¾ç”Ÿå¯¹è±¡</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2354633166/">OOP50-CPP ä¸è¦åœ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½å‡½å‡½æ•°</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> å‹æƒ…é“¾æ¥</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright Â© 2022 <a href="/." rel="nofollow">Sun of Beach.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="200" src="//lib.baomitu.com/canvas-nest.js/latest/canvas-nest.js"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="å¤åˆ¶æˆåŠŸ!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>
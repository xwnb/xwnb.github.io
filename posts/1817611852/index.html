<!-- build time:Sun Nov 14 2021 11:53:08 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Helvetica Neue, Helvetica, Hiragino Sans GB, Microsoft YaHei, Source Han Sans CN, WenQuanYi Micro Hei, Arial, sans-serif:300,300italic,400,400italic,700,700italic|Consolas, Monaco, Menlo, monospace:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"xwnb.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="原文链接：MEM54-CPP. Provide placement new with properly aligned pointers to sufficient storage capacity"><meta property="og:type" content="article"><meta property="og:title" content="MEM54-CPP. 为 placement new 提供足够内存容量的正确对齐的指针"><meta property="og:url" content="https://xwnb.github.io/posts/1817611852/index.html"><meta property="og:site_name" content="Sun of Beach"><meta property="og:description" content="原文链接：MEM54-CPP. Provide placement new with properly aligned pointers to sufficient storage capacity"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6QXhpdmlvbiBCYXVoYXVzIFN1aXRlX1Z9&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6SGVsaXggUUFDX1Z9&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6TERSQV9WfQ&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UGFyYXNvZnRfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UG9seXNwYWNlIEJ1ZyBGaW5kZXJfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFZTLVN0dWRpb19WfQ&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_left.png?version=1&amp;modificationDate=1216910800000&amp;api=v2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_up.png?version=1&amp;modificationDate=1216910618000&amp;api=v2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_right.png?version=1&amp;modificationDate=1216910815000&amp;api=v2"><meta property="article:published_time" content="2021-11-14T15:54:15.000Z"><meta property="article:modified_time" content="2021-11-14T11:52:44.405Z"><meta property="article:author" content="村口最靓的 小Xu"><meta property="article:tag" content="SEI CERT C++"><meta property="article:tag" content="编码规范"><meta property="article:tag" content="翻译"><meta property="article:tag" content="Memory Management"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6QXhpdmlvbiBCYXVoYXVzIFN1aXRlX1Z9&amp;locale=zh_CN&amp;version=2"><link rel="canonical" href="https://xwnb.github.io/posts/1817611852/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>#needsharebutton-float{bottom:88px;cursor:pointer;left:-8px;position:fixed;z-index:9999}#needsharebutton-float .btn{border:1px solid $btn-default-border-color;border-radius:4px;padding:0 10px 0 14px}</style><title>MEM54-CPP. 为 placement new 提供足够内存容量的正确对齐的指针 | Sun of Beach</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Sun of Beach" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Sun of Beach</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Stay Angry, Stay Foolish</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/xwnb" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://xwnb.github.io/posts/1817611852/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/profile-picture.jpg"><meta itemprop="name" content="村口最靓的 小Xu"><meta itemprop="description" content="个人站，学习记录、实践教程、资料收集等，哈哈哈。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sun of Beach"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MEM54-CPP. 为 placement new 提供足够内存容量的正确对齐的指针</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-14 15:54:15 / 修改时间：11:52:44" itemprop="dateCreated datePublished" datetime="2021-11-14T15:54:15+00:00">2021-11-14</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/SEI-CERT-C/" itemprop="url" rel="index"><span itemprop="name">SEI CERT C++</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.5k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>3 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>原文链接：</p><p><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/MEM54-CPP.+Provide+placement+new+with+properly+aligned+pointers+to+sufficient+storage+capacity" target="_blank" rel="noopener">MEM54-CPP. Provide placement new with properly aligned pointers to sufficient storage capacity</a></p><a id="more"></a><hr><p>当为给定类型调用 <code>new</code> 表达式, <code>operator new</code> 的默认全局 non-placement 形式试图给该类型对象分配足够的内存空间, 如果成功, 返回一个对齐指针–适用于任何有基本对齐要求的对象. 然而, 默认 placement <code>new</code> 操作符简单地将已知的指针返回给调用者–不保证有足够的内存空间去构造对象或者确保该指针满足正确的对齐要求. C++ 标准, [expr.new], 段落 16 [<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IEC14882-2014" target="_blank" rel="noopener">ISO/IEC 14882-2014</a>], 非规范陈述如下:</p><blockquote><p>[备注: 当分配函数返回了一个非空值, 这必须是一个指向已经被预留的存储区块的指针. 这个存储区块假设被正确对齐且具有所申请的尺寸大小. 如果对象是数组, 所创建的对象地址不必和该存储区块的地址相同. —备注结束]</p><p>[Note: when the allocation function returns a value other than null, it must be a pointer to a block of storage in which space for the object has been reserved. The block of storage is assumed to be appropriately aligned and of the requested size. The address of the created object will not necessarily be the same as that of the block if the object is an array. —end note]</p></blockquote><p>(这个备注是 C++ 标准所规定的常规要求的提醒, [basic.stc.dynamic.allocation], 段落 1, 借助 [basic.stc.dynamic], 段落 3, 作用于 placement <code>new</code> 操作符)</p><p>此外, 标准在这章节后面提供了一个例子:</p><blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>(<span class="number">2</span>, f) T[<span class="number">5</span>] `results in a call` of <span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="keyword">sizeof</span>(T) * <span class="number">5</span> + y, <span class="number">2</span>, f).</span><br></pre></td></tr></table></figure><p>这里, <code>...</code> 和 <code>y</code> 是未指明的非负值, 表示数组分配的开销; new 表达式的结果将会补偿 <code>operator new[]</code> 返回值的大小. 这个开销可能被作用于所有的 <em>new 表达式</em>, 包括那些引用于库函数 <code>operator new[](std::size_t, void*)</code> 和其他 placement 分配函数. 这个开销大小可能因每次 new 调用的不同而不同.</p><p>Here, <code>...</code> and <code>y</code> are non-negative unspecified values representing array allocation overhead; the result of the new-expression will be offset by this amount from the value returned by <code>operator new[]</code>. This overhead may be applied in all array <em>new-expressions</em>, including those referencing the library function <code>operator new[](std::size_t, void*)</code> and other placement allocation functions. The amount of overhead may vary from one invocation of new to another.</p></blockquote><p>不要向 placement <code>new</code> 传递一个用于构造对象的未正确对齐的指针. 这会导致对象被构造在一个错误对齐的位置, 导致 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-undefinedbehavior" target="_blank" rel="noopener">未定义行为, undefined behavior</a>. 不要传递一个没有足够存储容量来构造对象的指针, 包括数组需补偿的大小. 这可能导致用于构造该对象的内存初始化时越界.</p><p>最后, 不要在任何没有指明所需开销限度的平台上使用 placement <code>new[]</code> .</p><h2 id="不合规代码示例"><a class="header-anchor" href="#不合规代码示例">¶</a>不合规代码示例</h2><p>在这个不合规的代码示例中, 一个指向 <code>short</code> 的指针被传入到 placement <code>new</code>, 试图用来初始化一个 <code>long</code> . 在 <code>sizeof(short) &lt; sizeof(long)</code> 的架构上, 这导致 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-undefinedbehavior" target="_blank" rel="noopener">未定义行为, undefined behavior</a>. 这个以及后面的例子, 都假设 placement <code>new</code> 返回的指针不会在其生命周期结束后被使用. 举个例子, 该指针不会被存储在一个 <code>静态</code> 全局变量中, 且在 <code>f()</code> 调用结束后不会被解引用. 这个假设符合 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/MEM50-CPP.+Do+not+access+freed+memory" target="_blank" rel="noopener">MEM50-CPP. Do not access freed memory</a>.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  short s;</span><br><span class="line">  <span class="keyword">long</span> *lp = ::<span class="keyword">new</span> (&amp;s) <span class="keyword">long</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="不合规代码示例-v2"><a class="header-anchor" href="#不合规代码示例-v2">¶</a>不合规代码示例</h2><p>这个不合规的代码示例确保 在足够大小的缓冲区中构造 <code>long</code> . 然而, 这不能保证传入到 placement <code>new</code> 的指针满足对齐要求. 为了使这个例子更加清晰, 声明了另一个局部变量 <code>c</code>.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> c; <span class="comment">// Used elsewhere in the function</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="keyword">sizeof</span>(<span class="keyword">long</span>)];</span><br><span class="line">  <span class="keyword">long</span> *lp = ::<span class="keyword">new</span> (<span class="built_in">buffer</span>) <span class="keyword">long</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-alignas"><a class="header-anchor" href="#合规方案-alignas">¶</a>合规方案 (<code>alignas</code>)</h2><p>在这个合规方案中, 声明修饰符 <code>alignas</code> 被用来确保用于 <code>long</code> 的缓冲区是正确对齐的.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> c; <span class="comment">// Used elsewhere in the function</span></span><br><span class="line">  <span class="keyword">alignas</span>(<span class="keyword">long</span>) <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="keyword">sizeof</span>(<span class="keyword">long</span>)];</span><br><span class="line">  <span class="keyword">long</span> *lp = ::<span class="keyword">new</span> (<span class="built_in">buffer</span>) <span class="keyword">long</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-std-aligned-storage"><a class="header-anchor" href="#合规方案-std-aligned-storage">¶</a>合规方案 (<code>std::aligned_storage</code>)</h2><p>这个合规方案确保在足够大小且正确对齐的缓冲区中构造 <code>long</code> .</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">char</span> c; <span class="comment">// Used elsewhere in the function</span></span><br><span class="line">  <span class="built_in">std</span>::aligned_storage&lt;<span class="keyword">sizeof</span>(<span class="keyword">long</span>), <span class="keyword">alignof</span>(<span class="keyword">long</span>)&gt;::type <span class="built_in">buffer</span>;</span><br><span class="line">  <span class="keyword">long</span> *lp = ::<span class="keyword">new</span> (&amp;<span class="built_in">buffer</span>) <span class="keyword">long</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="不合规代码示例-Failure-to-Account-for-Array-Overhead"><a class="header-anchor" href="#不合规代码示例-Failure-to-Account-for-Array-Overhead">¶</a>不合规代码示例 (Failure to Account for Array Overhead)</h2><p>这个不合规代码示例试图为对象 <code>S</code> 的数组分配正确对齐且充足的内存空间. 然而, 这错误计算了开销–实现可能会为数组对象增加存储大小. 这类开销 (一般称为 cookie ) 是必需的–存储数组中元素的数目, 以便于数组删除表达式或者异常解构机制 (注: exception unwinding mechanism) 可以调用数组中每个被成功构造元素的析构函数. 但是有些实现在某些情况下能够避免给 cookie 分配空间, 假设它们在所有情况下的操作是不安全的.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">  S ();</span><br><span class="line">  ~S ();</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">unsigned</span> N = <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">alignas</span>(S) <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="keyword">sizeof</span>(S) * N];</span><br><span class="line">  S *sp = ::<span class="keyword">new</span> (<span class="built_in">buffer</span>) S[N];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// Destroy elements of the array.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i != n; ++i) &#123;</span><br><span class="line">    sp[i].~S();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-Clang-GCC"><a class="header-anchor" href="#合规方案-Clang-GCC">¶</a>合规方案 (Clang/GCC)</h2><p>数组 <code>new</code> 表达式所需的开销大小是不明确的, 但是理想情况下, 这应该被良好的实现记录下来. 下述的合规方案是特地为 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-clang" target="_blank" rel="noopener">Clang </a>和 GNU <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-gcc" target="_blank" rel="noopener">GCC </a>编译器的, 这保证了动态数组分配的开销是单个类型 <code>size_t</code> 的值. (注意这个值一般会被当做数组的 “第-1个” 元素, 所以实际被使用的空间可能会更大.) 为了证实这个假设实际上是安全的, 该合规方案也重载了 placement <code>new[]</code> 操作符来接受缓冲区大小–作为第三个参数, 并且证实这不比所需的存储空间总大小小.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstddef&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(__clang__) || defined(__GNUG__)</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> overhead = <span class="keyword">sizeof</span>(<span class="keyword">size_t</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">static_assert</span>(<span class="literal">false</span>, <span class="string">"you need to determine the size of your implementation's array overhead"</span>);</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> overhead = <span class="number">0</span>; <span class="comment">// Declaration prevents additional diagnostics about overhead being undefined; the value used does not matter.</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">S</span> &#123;</span></span><br><span class="line">  S();</span><br><span class="line">  ~S();</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">void</span> *<span class="keyword">operator</span> <span class="keyword">new</span>[](<span class="keyword">size_t</span> n, <span class="keyword">void</span> *p, <span class="keyword">size_t</span> bufsize) &#123;</span><br><span class="line">  <span class="keyword">if</span> (n &gt; bufsize) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">std</span>::bad_array_new_length();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">size_t</span> n = <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">alignas</span>(S) <span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">buffer</span>[<span class="keyword">sizeof</span>(S) * n + <span class="built_in">std</span>::<span class="built_in">max</span>(overhead, <span class="keyword">alignof</span>(S))];</span><br><span class="line">  S *sp = ::<span class="keyword">new</span> (<span class="built_in">buffer</span>, <span class="keyword">sizeof</span>(<span class="built_in">buffer</span>)) S[n];</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// Destroy elements of the array.</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i != n; ++i) &#123;</span><br><span class="line">    sp[i].~S();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将该合规方案移植到其他实现需要增加类似开销常数的条件定义–依赖于平台的约束.</p><h2 id="风险预估"><a class="header-anchor" href="#风险预估">¶</a>风险预估</h2><p>向 placement <code>new</code> 表达式传递不正确对齐的指针或者指向不充足存储空间的指针会导致 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-undefinedbehavior" target="_blank" rel="noopener">未定义行为, undefined behavior</a>, 包括缓冲区溢出和 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-abnormaltermination" target="_blank" rel="noopener">异常终止, abnormal termination</a>.</p><table><thead><tr><th style="text-align:left">Rule</th><th style="text-align:left">Severity</th><th style="text-align:left">Likelihood</th><th style="text-align:left">Remediation Cost</th><th style="text-align:left">Priority</th><th style="text-align:left">Level</th></tr></thead><tbody><tr><td style="text-align:left">MEM54-CPP</td><td style="text-align:left">High</td><td style="text-align:left">Likely</td><td style="text-align:left">Medium</td><td style="text-align:left"><strong>P18</strong></td><td style="text-align:left"><strong>L1</strong></td></tr></tbody></table><h3 id="Automated-Detection"><a class="header-anchor" href="#Automated-Detection">¶</a>Automated Detection</h3><table><thead><tr><th style="text-align:left">Tool</th><th style="text-align:left">Version</th><th style="text-align:left">Checker</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Axivion+Bauhaus+Suite" target="_blank" rel="noopener">Axivion Bauhaus Suite</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6QXhpdmlvbiBCYXVoYXVzIFN1aXRlX1Z9&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>CertC+±MEM54</strong></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Helix+QAC" target="_blank" rel="noopener">Helix QAC</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6SGVsaXggUUFDX1Z9&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>C<ins>3119, C</ins>3128</strong></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/LDRA" target="_blank" rel="noopener">LDRA tool suite</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6TERSQV9WfQ&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>597 S</strong>** **</td><td style="text-align:left">Enhanced Enforcement</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Parasoft" target="_blank" rel="noopener">Parasoft C/C++test</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UGFyYXNvZnRfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>CERT_CPP-MEM54-a</strong> <strong>CERT_CPP-MEM54-b</strong></td><td style="text-align:left">Do not pass a pointer that has insufficient storage capacity or that is not suitably aligned for the object being constructed to placement ‘new’ An overhead should be used when an array of objects is passed to the placement ‘new’ allocation function</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Polyspace+Bug+Finder" target="_blank" rel="noopener">Polyspace Bug Finder</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UG9seXNwYWNlIEJ1ZyBGaW5kZXJfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><a href="https://www.mathworks.com/help/bugfinder/ref/certcmem54cpp.html" target="_blank" rel="noopener">CERT C++: MEM54-CPP</a></td><td style="text-align:left">Checks for placement new used with insufficient storage or misaligned pointers (rule fully covered)</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/PVS-Studio" target="_blank" rel="noopener">PVS-Studio</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFZTLVN0dWRpb19WfQ&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong><a href="https://pvs-studio.com/en/docs/warnings/v752/" target="_blank" rel="noopener">V752</a></strong></td><td style="text-align:left"></td></tr></tbody></table><h2 id="Related-Vulnerabilities"><a class="header-anchor" href="#Related-Vulnerabilities">¶</a>Related Vulnerabilities</h2><p>Search for <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-vulner" target="_blank" rel="noopener">vulnerabilities</a> resulting from the violation of this rule on the <a href="https://www.kb.cert.org/vulnotes/bymetric?searchview&amp;query=FIELD+KEYWORDS+contains+MEM45-CPP" target="_blank" rel="noopener">CERT website</a>.</p><h2 id="Related-Guidelines"><a class="header-anchor" href="#Related-Guidelines">¶</a>Related Guidelines</h2><table><thead><tr><th><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046682" target="_blank" rel="noopener">SEI CERT C++ Coding Standard</a></th><th><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/MEM50-CPP.+Do+not+access+freed+memory" target="_blank" rel="noopener">MEM50-CPP. Do not access freed memory</a></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><h2 id="Bibliography"><a class="header-anchor" href="#Bibliography">¶</a>Bibliography</h2><table><thead><tr><th>[<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IEC14882-2014" target="_blank" rel="noopener">ISO/IEC 14882-2014</a>]</th><th>Subclause 3.7.4, “Dynamic Storage Duration” Subclause 5.3.4, “New”</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table><hr><p><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046356" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_left.png?version=1&amp;modificationDate=1216910800000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_left.png"> </a><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046329" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_up.png?version=1&amp;modificationDate=1216910618000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_up.png"> </a><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046441" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_right.png?version=1&amp;modificationDate=1216910815000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_right.png"></a></p></div><div class="popular-posts-header">推荐文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/3526747646/" rel="bookmark">MEM55-CPP. 遵守替换动态内存管理的要求</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/4036605331/" rel="bookmark">MEM53-CPP. 当手动管理对象生命周期时, 显式构造和析构对象</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/1181891836/" rel="bookmark">MEM52-CPP. 检测并处理内存分配错误</a></div></li></ul><div class="reward-container"><div></div><button onclick='var e=document.getElementById("qr");e.style.display="none"===e.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.jpg" alt="村口最靓的 小Xu 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="村口最靓的 小Xu 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>村口最靓的 小Xu</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://xwnb.github.io/posts/1817611852/" title="MEM54-CPP. 为 placement new 提供足够内存容量的正确对齐的指针">https://xwnb.github.io/posts/1817611852/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/wechat_channel.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="https://blog.csdn.net/xiaowei1234565"><span class="icon"><i class="fab fa-blogger"></i> </span><span class="label">CSDN</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/SEI-CERT-C/" rel="tag"><i class="fa fa-tag"></i> SEI CERT C++</a> <a href="/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" rel="tag"><i class="fa fa-tag"></i> 编码规范</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag"><i class="fa fa-tag"></i> 翻译</a> <a href="/tags/Memory-Management/" rel="tag"><i class="fa fa-tag"></i> Memory Management</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/3526747646/" rel="prev" title="MEM55-CPP. 遵守替换动态内存管理的要求"><i class="fa fa-chevron-left"></i> MEM55-CPP. 遵守替换动态内存管理的要求</a></div><div class="post-nav-item"><a href="/posts/4036605331/" rel="next" title="MEM53-CPP. 当手动管理对象生命周期时, 显式构造和析构对象">MEM53-CPP. 当手动管理对象生命周期时, 显式构造和析构对象 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#不合规代码示例"><span class="nav-text">不合规代码示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不合规代码示例-v2"><span class="nav-text">不合规代码示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-alignas"><span class="nav-text">合规方案 (alignas)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-std-aligned-storage"><span class="nav-text">合规方案 (std::aligned_storage)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不合规代码示例-Failure-to-Account-for-Array-Overhead"><span class="nav-text">不合规代码示例 (Failure to Account for Array Overhead)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-Clang-GCC"><span class="nav-text">合规方案 (Clang&#x2F;GCC)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#风险预估"><span class="nav-text">风险预估</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Automated-Detection"><span class="nav-text">Automated Detection</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Related-Vulnerabilities"><span class="nav-text">Related Vulnerabilities</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Related-Guidelines"><span class="nav-text">Related Guidelines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bibliography"><span class="nav-text">Bibliography</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="村口最靓的 小Xu" src="/images/profile-picture.jpg"><p class="site-author-name" itemprop="name">村口最靓的 小Xu</p><div class="site-description" itemprop="description">个人站，学习记录、实践教程、资料收集等，哈哈哈。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">38</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/xwnb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xwnb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="/www.weibo.com" title="Weibo → www.weibo.com"><i class="fab fa-weibo fa-fw"></i>Weibo</a> </span><span class="links-of-author-item"><a href="/www.google.com" title="Google → www.google.com"><i class="fab fa-google fa-fw"></i>Google</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Friend Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://blog.csdn.net/xiaowei1234565" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiaowei1234565" rel="noopener" target="_blank">CSDN</a></li><li class="links-of-blogroll-item"><a href="https://www.cnblogs.com/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;" rel="noopener" target="_blank">CNBLOGS</a></li><li class="links-of-blogroll-item"><a href="https://www.oschina.net/" title="https:&#x2F;&#x2F;www.oschina.net&#x2F;" rel="noopener" target="_blank">OSCHINA</a></li><li class="links-of-blogroll-item"><a href="https://www.v2ex.com/" title="https:&#x2F;&#x2F;www.v2ex.com&#x2F;" rel="noopener" target="_blank">V2EX</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><img src="http://ghchart.rshah.org/xwnb" alt="xwnb's Github chart"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user-circle"></i> </span><span class="author" itemprop="copyrightHolder">村口最靓的 小Xu</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">132k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:01</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>!function(){var e,t,o=document.getElementsByTagName("link");if(o.length>0)for(i=0;i<o.length;i++)"canonical"==o[i].rel.toLowerCase()&&o[i].href&&(e=o[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e||(e=window.location.href),!function(){var i=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,o=e,r=document.referrer;if(!i.test(o)){var n="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";r?(n+="?r="+encodeURIComponent(document.referrer),o&&(n+="&l="+o)):o&&(n+="?l="+o);var a=new Image;a.src=n}}(window)}()</script><script>if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }</script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://xwnb.github.io/posts/1817611852/',]
      });
      });</script><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>flOptions={},flOptions.iconStyle="box",flOptions.boxForm="vertical",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js server="netease" type="playlist" id="60498371" autoplay fixed="true" mutex="true" order="random"></meting-js></body></html><!-- rebuild by neat -->
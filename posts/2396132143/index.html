<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人站，学习记录、实践教程、资料收集等，哈哈哈。"><title>CTR50-CPP. 保证容器索引和迭代器在有效范围内 | Sun of Beach</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><div class="darkmode-toggle">🌓</div><script>var prefersDarkMode = window.matchMedia('(prefers-color-scheme: dark)');
var toggle = document.querySelector('.darkmode-toggle');
var html = document.querySelector('html');

html.dataset.dark = localStorage.dark || prefersDarkMode.matches;

toggle.addEventListener('click', () => {
localStorage.dark = !(html.dataset.dark == 'true');
html.dataset.dark = localStorage.dark;
});</script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">CTR50-CPP. 保证容器索引和迭代器在有效范围内</h1><a id="logo" href="/.">Sun of Beach</a><p class="description">Stay Angry, Stay Foolish</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">CTR50-CPP. 保证容器索引和迭代器在有效范围内</h1><div class="post-meta">2020-06-25<span> | </span><span class="category"><a href="/categories/SEI-CERT-C/">SEI CERT C++</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.9k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 10</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>原文链接：</p>
<p><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/CTR50-CPP.+Guarantee+that+container+indices+and+iterators+are+within+the+valid+range">CTR50-CPP. 保证容器索引和迭代器在有效范围内</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/CTR50-CPP.+Guarantee+that+container+indices+and+iterators+are+within+the+valid+range">https://wiki.sei.cmu.edu/confluence/display/cplusplus/CTR50-CPP.+Guarantee+that+container+indices+and+iterators+are+within+the+valid+range</a></p>
<span id="more"></span>

<p>保证数据引用在数据的边界范围内是程序员一定要负全责的。同理，当程序员使用标准模板容器库，也需要确保索引在容器范围之内。</p>
<p>Ensuring that array references are within the bounds of the array is almost entirely the responsibility of the programmer. Likewise, when using standard template library vectors, the programmer is responsible for ensuring integer indexes are within the bounds of the vector.</p>
<h2 id="不合规代码示例（指针）-Noncompliant-Code-Example-Pointers"><a href="#不合规代码示例（指针）-Noncompliant-Code-Example-Pointers" class="headerlink" title="不合规代码示例（指针） Noncompliant Code Example (Pointers)"></a>不合规代码示例（指针） Noncompliant Code Example (Pointers)</h2><p>这个不合规代码示例展示了一个函数，<code>insert_in_table()</code>，包含两个 <code>int</code> 参数，<code>pos</code> 和 <code>value</code>，会受来自不可信源的数据影响。函数执行了范围检查以确保 <code>pos</code> 不会超出数组的上界，由 <code>tableSize</code> 指定，但是未检查下界。因为 <code>pos</code> 被声明为一个 (signed) <code>int</code>，这个参数可以设想为一个负数，导致一次超出 <code>table</code> 引用的内存范围的写入。</p>
<p>This noncompliant code example shows a function, <code>insert_in_table()</code>, that has two <code>int</code> parameters, <code>pos</code> and <code>value</code>, both of which can be influenced by data originating from untrusted sources. The function performs a range check to ensure that <code>pos</code> does not exceed the upper bound of the array, specified by <code>tableSize</code>, but fails to check the lower bound. Because <code>pos</code> is declared as a (signed) <code>int</code>, this parameter can assume a negative value, resulting in a write outside the bounds of the memory referenced by <code>table</code>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstddef&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(<span class="type">int</span> *table, std::<span class="type">size_t</span> tableSize, <span class="type">int</span> pos, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= tableSize) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table[pos] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合规的方案-size-t-Compliant-Solution-size-t"><a href="#合规的方案-size-t-Compliant-Solution-size-t" class="headerlink" title="合规的方案 (size_t) Compliant Solution (size_t)"></a>合规的方案 (<code>size_t</code>) Compliant Solution (<code>size_t</code>)</h2><p>这个合规的方案中，参数 <code>pos</code> 被声明为 <code>size_t</code>，可以避免传入负值变量。</p>
<p>In this compliant solution, the parameter <code>pos</code> is declared as <code>size_t</code>, which prevents the passing of negative arguments.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstddef&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(<span class="type">int</span> *table, std::<span class="type">size_t</span> tableSize, std::<span class="type">size_t</span> pos, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= tableSize) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table[pos] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合规的方案-Non-Type-Templates-Compliant-Solution-Non-Type-Templates"><a href="#合规的方案-Non-Type-Templates-Compliant-Solution-Non-Type-Templates" class="headerlink" title="合规的方案 (Non-Type Templates) Compliant Solution (Non-Type Templates)"></a>合规的方案 (Non-Type Templates) Compliant Solution (Non-Type Templates)</h2><p>无类型模板可以被用来定义接收一个数组类型的函数，数组边界可以编译器推导。这个合规的方案与先前需要在调用 <code>insert_in_table</code> 时额外提供一个已知边界的边界检查方案，在功能上等价的。</p>
<p>Non-type templates can be used to define functions accepting an array type where the array bounds are deduced at compile time. This compliant solution is functionally equivalent to the previous bounds-checking one except that it additionally supports calling <code>insert_in_table()</code> with an array of known bounds.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstddef&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;new&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(<span class="type">int</span> *table, std::<span class="type">size_t</span> tableSize, std::<span class="type">size_t</span> pos, <span class="type">int</span> value)</span> </span>&#123; <span class="comment">// #1</span></span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= tableSize) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table[pos] = value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;std::<span class="type">size_t</span> N&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(<span class="type">int</span> (&amp;table)[N], std::<span class="type">size_t</span> pos, <span class="type">int</span> value)</span> </span>&#123; <span class="comment">// #2</span></span><br><span class="line">  <span class="built_in">insert_in_table</span>(table, N, pos, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Exposition only</span></span><br><span class="line">  <span class="type">int</span> table1[<span class="number">100</span>];</span><br><span class="line">  <span class="type">int</span> *table2 = <span class="keyword">new</span> <span class="type">int</span>[<span class="number">100</span>];</span><br><span class="line">  <span class="built_in">insert_in_table</span>(table1, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// Calls #2</span></span><br><span class="line">  <span class="built_in">insert_in_table</span>(table2, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// Error, no matching function call</span></span><br><span class="line">  <span class="built_in">insert_in_table</span>(table1, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// Calls #1</span></span><br><span class="line">  <span class="built_in">insert_in_table</span>(table2, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// Calls #1</span></span><br><span class="line">  <span class="keyword">delete</span> [] table2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="不合规代码示例-std-vector-Noncompliant-Code-Example-std-vector"><a href="#不合规代码示例-std-vector-Noncompliant-Code-Example-std-vector" class="headerlink" title="不合规代码示例 (std::vector) Noncompliant Code Example (std::vector)"></a>不合规代码示例 (<code>std::vector</code>) Noncompliant Code Example (<code>std::vector</code>)</h2><p>在这个不合规的代码示例中，<code>std::vector</code> 被用来替换指针和尺寸。这个函数执行一次范围检查确保 <code>pos</code> 不会超出容器的上边界。因为 <code>pos</code> 被声明为一个 (signed) <code>long long</code>，这个参数可以是负数。在把 <code>std::vector::size_type</code> 以 <code>unsigned int</code> 来实现的系统中 (例如 <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-msvc">Microsoft Visual Studio</a>2013)，对于比较表达式，一般的算数转换会被用来将无符号值转换为有符号值。如果 <code>pos</code> 是一个负值， 这次比较将不会失败，当负值在索引操作中被解释为一个大的无符号值，将导致一次 <code>std::vector</code> 对象的越界写入。</p>
<p>In this noncompliant code example, a <code>std::vector</code> is used in place of a pointer and size pair. The function performs a range check to ensure that <code>pos</code> does not exceed the upper bound of the container. Because <code>pos</code> is declared as a (signed) <code>long long</code>, this parameter can assume a negative value. On systems where <code>std::vector::size_type</code> is ultimately implemented as an <code>unsigned int</code> (such as with <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-msvc">Microsoft Visual Studio</a>2013), the usual arithmetic conversions applied for the comparison expression will convert the unsigned value to a signed value. If <code>pos</code> has a negative value, this comparison will not fail, resulting in a write outside the bounds of the <code>std::vector</code> object when the negative value is interpreted as a large unsigned value in the indexing operator.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; &amp;table, <span class="type">long</span> <span class="type">long</span> pos, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= table.<span class="built_in">size</span>()) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table[pos] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合规方案-std-vector-size-t-Compliant-Solution-std-vector-size-t"><a href="#合规方案-std-vector-size-t-Compliant-Solution-std-vector-size-t" class="headerlink" title="合规方案 (std::vector, size_t) Compliant Solution (std::vector, size_t)"></a>合规方案 (<code>std::vector</code>, <code>size_t</code>) Compliant Solution (<code>std::vector</code>, <code>size_t</code>)</h2><p>在这个合规的方案中，参数 <code>pos</code> 被声明为 <code>size_t</code>，确保了当给定一个大的正数 (从一个负数变量转换而来)， 比较表达式执行失败。</p>
<p>In this compliant solution, the parameter <code>pos</code> is declared as <code>size_t</code>, which ensures that the comparison expression will fail when a large, positive value (converted from a negative argument) is given.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; &amp;table, std::<span class="type">size_t</span> pos, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (pos &gt;= table.<span class="built_in">size</span>()) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  table[pos] = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合规的方案-std-vector-at-Compliant-Solution-std-vector-at"><a href="#合规的方案-std-vector-at-Compliant-Solution-std-vector-at" class="headerlink" title="合规的方案 (std::vector::at()) Compliant Solution (std::vector::at())"></a>合规的方案 (<code>std::vector::at()</code>) Compliant Solution (<code>std::vector::at()</code>)</h2><p>这个合规的方案中，通过 <code>at()</code> 方法来访问容器。这个方案提供了边界检查，如果 <code>pos</code> 不是一个有效的索引值时，抛出一个 <code>std::out_of_range</code> 异常。<code>insert_in_table()</code> 被定义为一个 <code>noexcept(false)</code> 函数，符合 <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/ERR55-CPP.+Honor+exception+specifications">ERR55-CPP. Honor exception specifications</a> 。</p>
<p>In this compliant solution, access to the vector is accomplished with the <code>at()</code> method. This method provides bounds checking, throwing a <code>std::out_of_range</code> exception if <code>pos</code> is not a valid index value. The <code>insert_in_table()</code> function is declared with <code>noexcept(false)</code> in compliance with <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/ERR55-CPP.+Honor+exception+specifications">ERR55-CPP. Honor exception specifications</a>.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">insert_in_table</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; &amp;table, std::<span class="type">size_t</span> pos, <span class="type">int</span> value)</span> <span class="title">noexcept</span><span class="params">(<span class="literal">false</span>)</span> </span>&#123;</span><br><span class="line">  table.<span class="built_in">at</span>(pos) = value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="不合规代码示例-Iterrators-Noncompliant-Code-Example-Iterators"><a href="#不合规代码示例-Iterrators-Noncompliant-Code-Example-Iterators" class="headerlink" title="不合规代码示例 (Iterrators) Noncompliant Code Example (Iterators)"></a>不合规代码示例 (Iterrators) Noncompliant Code Example (Iterators)</h2><p>在这个不合规的代码示例中，函数 <code>f_imp()</code> 给定了 (正确的) 容器尾迭代器 <code>e</code>，<code>b</code> 是同个容器的迭代器。然而，<code>b</code> 不在该容器的有效范围内也是有可能的。举个例子，如果容器是空的，<code>b</code> 将和 <code>e</code> 相等，导致不正确的引用。</p>
<p>In this noncompliant code example, the <code>f_imp()</code> function is given the (correct) ending iterator <code>e</code> for a container, and <code>b</code> is an iterator from the same container. However, it is possible that <code>b</code> is not within the valid range of its container. For instance, if the container were empty, <code>b</code> would equal <code>e</code> and be improperly dereferenced.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iterator&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ForwardIterator&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f_imp</span><span class="params">(ForwardIterator b, ForwardIterator e, <span class="type">int</span> val, std::forward_iterator_tag)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    *b++ = val;</span><br><span class="line">  &#125; <span class="keyword">while</span> (b != e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ForwardIterator&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(ForwardIterator b, ForwardIterator e, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typename</span> std::iterator_traits&lt;ForwardIterator&gt;::iterator_category cat;</span><br><span class="line">  <span class="built_in">f_imp</span>(b, e, val, cat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="合规方案-Compliant-Solution"><a href="#合规方案-Compliant-Solution" class="headerlink" title="合规方案 Compliant Solution"></a>合规方案 Compliant Solution</h2><p>这个合规方案在试图解引用 <code>b</code> 前对迭代器有效性做了测试。</p>
<p>This compliant solution tests for iterator validity before attempting to dereference <code>b.</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iterator&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ForwardIterator&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f_imp</span><span class="params">(ForwardIterator b, ForwardIterator e, <span class="type">int</span> val, std::forward_iterator_tag)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (b != e) &#123;</span><br><span class="line">    *b++ = val;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> ForwardIterator&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f</span><span class="params">(ForwardIterator b, ForwardIterator e, <span class="type">int</span> val)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">typename</span> std::iterator_traits&lt;ForwardIterator&gt;::iterator_category cat;</span><br><span class="line">  <span class="built_in">f_imp</span>(b, e, val, cat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Risk-Assessment"><a href="#Risk-Assessment" class="headerlink" title="Risk Assessment"></a>Risk Assessment</h2><p>Using an invalid array or container index can result in an arbitrary memory overwrite or <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-abnormaltermination">abnormal program termination</a>.</p>
<table>
<thead>
<tr>
<th align="left">Rule</th>
<th align="left">Severity</th>
<th align="left">Likelihood</th>
<th align="left">Remediation Cost</th>
<th align="left">Priority</th>
<th align="left">Level</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CTR50-CPP</td>
<td align="left">High</td>
<td align="left">Likely</td>
<td align="left">High</td>
<td align="left"><strong>P9</strong></td>
<td align="left"><strong>L2</strong></td>
</tr>
</tbody></table>
<h2 id="Automated-Detection"><a href="#Automated-Detection" class="headerlink" title="Automated Detection"></a>Automated Detection</h2><table>
<thead>
<tr>
<th align="left">Tool</th>
<th align="left">Version</th>
<th align="left">Checker</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/CodeSonar">CodeSonar</a></td>
<td align="left">5.3p0</td>
<td align="left">**LANG.MEM.BO LANG.MEM.BU LANG.MEM.TO LANG.MEM.TU **<strong>LANG.MEM.TBA *</strong>*LANG.STRUCT.PBB ****LANG.STRUCT.PPE**</td>
<td align="left">Buffer overrun Buffer underrun Type overrun Type underrun Tainted buffer access Pointer before beginning of object Pointer past end of object</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://www.securecoding.cert.org/confluence/display/cplusplus/Klocwork">Klocwork</a></td>
<td align="left">2018</td>
<td align="left"><strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">ABV.ANY_SIZE_ARRAY</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">ABV.GENERAL</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">ABV.STACK</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">ABV.TAINTED</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">SV.TAINTED.ALLOC_SIZE</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">SV.TAINTED.CALL.INDEX_ACCESS</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">SV.TAINTED.CALL.LOOP_BOUND</a></strong> <strong><a target="_blank" rel="noopener" href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/">SV.TAINTED.INDEX_ACCESS</a></strong></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/LDRA">LDRA tool suite</a></td>
<td align="left">9.7.1</td>
<td align="left"><strong>45 D, 47 S, 476 S, 489 S, 64 X, 66 X, 68 X, 69 X, 70 X, 71 X, 79 X**</strong> **</td>
<td align="left">Partially implemented</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Parasoft">Parasoft C&#x2F;C++test</a></td>
<td align="left">10.4.2</td>
<td align="left"><strong>CERT_CPP-CTR50-a</strong></td>
<td align="left">Guarantee that container indices are within the valid range</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Polyspace+Bug+Finder">Polyspace Bug Finder</a></td>
<td align="left">R2020a</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.mathworks.com/help/bugfinder/ref/certcctr50cpp.html">CERT C++: CTR50-CPP</a></td>
<td align="left">Checks for:Array access out of boundsArray access with tainted indexPointer dereference with tainted offsetRule partially covered.</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046345">PRQA QA-C++</a></td>
<td align="left">4.4</td>
<td align="left"><strong>2891, 3139, 3140</strong></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/PVS-Studio">PVS-Studio</a></td>
<td align="left">7.07</td>
<td align="left"><strong><a target="_blank" rel="noopener" href="https://www.viva64.com/en/w/v781/">V781</a></strong></td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="Related-Vulnerabilities"><a href="#Related-Vulnerabilities" class="headerlink" title="Related Vulnerabilities"></a>Related Vulnerabilities</h2><p>Search for <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-vulnerabi">vulnerabilities</a> resulting from the violation of this rule on the <a target="_blank" rel="noopener" href="https://www.kb.cert.org/vulnotes/bymetric?searchview&query=FIELD+KEYWORDS+contains+CTR50-CPP">CERT website</a>.</p>
<h2 id="Related-Guidelines"><a href="#Related-Guidelines" class="headerlink" title="Related Guidelines"></a>Related Guidelines</h2><table>
<thead>
<tr>
<th><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/c/SEI+CERT+C+Coding+Standard">SEI CERT C Coding Standard</a></th>
<th><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/c/ARR30-C.+Do+not+form+or+use+out-of-bounds+pointers+or+array+subscripts">ARR30-C. Do not form or use out-of-bounds pointers or array subscripts</a></th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="http://cwe.mitre.org/">MITRE CWE</a></td>
<td><a target="_blank" rel="noopener" href="http://cwe.mitre.org/data/definitions/119.html">CWE 119</a>, Failure to Constrain Operations within the Bounds of a Memory Buffer <a target="_blank" rel="noopener" href="http://cwe.mitre.org/data/definitions/129.html">CWE 129</a>, Improper Validation of Array Index</td>
</tr>
</tbody></table>
<h2 id="Bibliography"><a href="#Bibliography" class="headerlink" title="Bibliography"></a>Bibliography</h2><table>
<thead>
<tr>
<th>[<a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IEC14882-2014">ISO&#x2F;IEC 14882-2014</a>]</th>
<th>Clause 23, “Containers Library” Subclause 24.2.1, “In General”</th>
</tr>
</thead>
<tbody><tr>
<td>[<a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IECTR24772-2013">ISO&#x2F;IEC TR 24772-2013</a>]</td>
<td>Boundary Beginning Violation [XYX] Wrap-Around Error [XYY] Unchecked Array Indexing [XYZ]</td>
</tr>
<tr>
<td>[<a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-Viega05">Viega 2005</a>]</td>
<td>Section 5.2.13, “Unchecked Array Indexing”</td>
</tr>
</tbody></table>
<hr>
<p><a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046331"><img src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_left.png?version=1&modificationDate=1216910800000&api=v2" alt="img"></a> <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046331"><img src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_up.png?version=1&modificationDate=1216910618000&api=v2" alt="img"></a> <a target="_blank" rel="noopener" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046457"><img src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_right.png?version=1&modificationDate=1216910815000&api=v2" alt="img"></a></p>
</div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css?v=1.0.0"><script type="text/javascript" src="/js/donate.js?v=1.0.0" successtext="复制成功！"></script><a class="pos-f tr3" id="github" href="https://github.com/Kaiyuan/donate-page" target="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="WeChat" qr="/img/wechatpay.jpg"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css?v=1.0.0"><p><span>本文标题：</span>CTR50-CPP. 保证容器索引和迭代器在有效范围内</p><p><span>文章作者：</span>xwnb</p><p><span>发布时间：</span>2020-06-25</p><p><span>最后更新：</span>2023-04-17</p><p><span>原始链接：</span><a href="/posts/2396132143/">https://xwnb.github.io/posts/2396132143/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://xwnb.github.io/posts/2396132143/"></i></span></p><p><span>版权声明：</span>本博客所有文章除特别声明外，均采用 BY-NC-SA 许可协议。转载请注明出处！并保留本声明。感谢您的阅读和支持！</p></div><br><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://xwnb.github.io/posts/2396132143/" data-id="clgkzup3200f81hldb5d5hw5i" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAACuCAAAAACKZ2kyAAAByUlEQVR42u3aQQ6DMAxEUe5/aXoASvljxxGVflaVQPDowvI4OQ68zsviV38/85hYcuXKbXPPn+v6aHL17s47LjHIlSt3P5c/jnzq3T3kgx9scuXKfSWXs8hz5MqV++9cnkReUcjkypXb5pLwQ17MhyDjWU2uXLkNbjrcnPg9Mt+VK1duiXuWVm3ThZet2/fKlSt3CzctOrwMkft52yRXrtydXD7sSIcXtVL4EKvkypW7hctHG2mA4QOUuJGSK1fuMLf24vQq2bZBBVSuXLlbuJ36V9tY7YQluXLl7uGmwSYNOenhrSCryZUrd4y7KqjwAxlpWApqnly5chdx+VYoaWtSFimRX7KaXLlyh7kcwe+JW5ZO3ZUrV+4AlwcVUs54+OGD16CEyZUrdxE3PZjF25F0BS2UXLlyh7kk9vTbmnTY+pDV5MqVO8ztFDLe9PDjX+jPkitX7jC31ojwcpY2Q/H8Rq5cuQNcvmrjzvQj+eFOuXLlTnNrhyrSD+iXPLly5e7npoPUWtRZnNXkypX7Ai4fa6ZbJkH4kStX7su4tQ3a2hAEbbXKlSt3mJuGn1VjkXiEKleu3C1cPjCtvTjdgFk235UrV26F+wHXF7R7gPUwJQAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/SEI CERT C++"><i class="fa fa-tag">SEI CERT C++</i></a><a href="/tags/编码规范"><i class="fa fa-tag">编码规范</i></a><a href="/tags/翻译"><i class="fa fa-tag">翻译</i></a><a href="/tags/CERT Containers"><i class="fa fa-tag">CERT Containers</i></a></div><div class="post-nav"><a class="pre" href="/posts/39044419/">CTR51-CPP. 使用有效的引用，指针，迭代器来引用容器的元素</a><a class="next" href="/posts/3114312552/">SEI CERT C++ Coding Standard 学习及翻译计划</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="/img/avatar.jpg"/></a><p>Stay Angry, Stay Foolish.</p><a class="info-icon" href="https://juejin.cn/user/435824491237181" title="掘金" target="_blank" style="margin-inline:5px"> <i class="fa fa-external-link-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/xwnb" title="GitHub" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ROS%E5%AD%A6%E4%B9%A0/">ROS学习</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SEI-CERT-C/">SEI CERT C++</a><span class="category-list-count">41</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tutorial/">Tutorial</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">微信小程序开发</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">自动驾驶</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><span class="category-list-count">5</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/" style="font-size: 15px;">自动驾驶</a> <a href="/tags/AirSim/" style="font-size: 15px;">AirSim</a> <a href="/tags/C-Weekly/" style="font-size: 15px;">C++ Weekly</a> <a href="/tags/Lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/Tutorial/" style="font-size: 15px;">Tutorial</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/wechat-dev/" style="font-size: 15px;">wechat-dev</a> <a href="/tags/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/" style="font-size: 15px;">路径规划</a> <a href="/tags/motion-planning/" style="font-size: 15px;">motion planning</a> <a href="/tags/A/" style="font-size: 15px;">A*</a> <a href="/tags/LPA/" style="font-size: 15px;">LPA*</a> <a href="/tags/RRT-Connect/" style="font-size: 15px;">RRT_Connect</a> <a href="/tags/RRT/" style="font-size: 15px;">RRT*</a> <a href="/tags/RRT/" style="font-size: 15px;">RRT</a> <a href="/tags/ROS/" style="font-size: 15px;">ROS</a> <a href="/tags/controller-manager/" style="font-size: 15px;">controller_manager</a> <a href="/tags/gazebo/" style="font-size: 15px;">gazebo</a> <a href="/tags/controller-manager/" style="font-size: 15px;">controller-manager</a> <a href="/tags/ur5/" style="font-size: 15px;">ur5</a> <a href="/tags/xacro/" style="font-size: 15px;">xacro</a> <a href="/tags/CON/" style="font-size: 15px;">CON</a> <a href="/tags/Concurrency/" style="font-size: 15px;">Concurrency</a> <a href="/tags/SEI-CERT-C/" style="font-size: 15px;">SEI CERT C++</a> <a href="/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 15px;">编码规范</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 15px;">翻译</a> <a href="/tags/CERT-Containers/" style="font-size: 15px;">CERT Containers</a> <a href="/tags/Input-Output/" style="font-size: 15px;">Input Output</a> <a href="/tags/Integers/" style="font-size: 15px;">Integers</a> <a href="/tags/INT/" style="font-size: 15px;">INT</a> <a href="/tags/Memory-Management/" style="font-size: 15px;">Memory Management</a> <a href="/tags/Object-Oriented-Programming/" style="font-size: 15px;">Object Oriented Programming</a> <a href="/tags/OOP/" style="font-size: 15px;">OOP</a> <a href="/tags/Characters-and-Strings/" style="font-size: 15px;">Characters and Strings</a> <a href="/tags/STR/" style="font-size: 15px;">STR</a> <a href="/tags/roslaunch/" style="font-size: 15px;">roslaunch</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/2750461479/">C++ Weekly Episode 162 Recursive Lambdas</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/176443133/">CON56-CPP. 不要对当前线程已经拥有的非递归互斥体进行假想锁定</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3196588117/">CON55-CPP. 使用条件变量时要保持线程安全和存活性</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1519021198/">CON54-CPP. 在循环中包装可能虚假唤醒的函数</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/730331528/">CON53-CPP. 避免死锁的方法：按预定义的顺序锁定</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3975169340/">CON52-CPP. 在多线程访问位域时避免数据竞争</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/3790056389/">CON50-CPP. 不要在互斥锁被锁定时销毁它</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/1519021197/">CON51-CPP. 确保在异常情况下释放被持有的活动的锁</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2113816124/">FIO51-CPP. 关闭不再需要的文件</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/2518610003/">OPP-CPP58. 拷贝操作绝不能改变源对象</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2023 <a href="/." rel="nofollow">Sun of Beach.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="200" src="//lib.baomitu.com/canvas-nest.js/latest/canvas-nest.js"></script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>
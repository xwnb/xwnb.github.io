<!-- build time:Mon Nov 15 2021 15:33:35 GMT+0000 (Coordinated Universal Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 4.2.1"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Helvetica Neue, Helvetica, Hiragino Sans GB, Microsoft YaHei, Source Han Sans CN, WenQuanYi Micro Hei, Arial, sans-serif:300,300italic,400,400italic,700,700italic|Consolas, Monaco, Menlo, monospace:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"xwnb.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!0},bookmark:{enable:!0,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="原文链接：MEM52-CPP. Detect and handle memory allocation errors"><meta property="og:type" content="article"><meta property="og:title" content="MEM52-CPP. 检测并处理内存分配错误"><meta property="og:url" content="https://xwnb.github.io/posts/1181891836/index.html"><meta property="og:site_name" content="Sun of Beach"><meta property="og:description" content="原文链接：MEM52-CPP. Detect and handle memory allocation errors"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6SGVsaXggUUFDX1Z9&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6S2xvY3dvcmtfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6TERSQV9WfQ&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UGFyYXNvZnRfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UG9seXNwYWNlIEJ1ZyBGaW5kZXJfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFJRQSBRQS1DKytfVn0&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFZTLVN0dWRpb19WfQ&amp;locale=zh_CN&amp;version=2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_left.png?version=1&amp;modificationDate=1216910800000&amp;api=v2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_up.png?version=1&amp;modificationDate=1216910618000&amp;api=v2"><meta property="og:image" content="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_right.png?version=1&amp;modificationDate=1216910815000&amp;api=v2"><meta property="article:published_time" content="2021-11-13T23:41:22.000Z"><meta property="article:modified_time" content="2021-11-15T15:33:07.311Z"><meta property="article:author" content="村口最靓的 小Xu"><meta property="article:tag" content="SEI CERT C++"><meta property="article:tag" content="编码规范"><meta property="article:tag" content="翻译"><meta property="article:tag" content="Memory Management"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6SGVsaXggUUFDX1Z9&amp;locale=zh_CN&amp;version=2"><link rel="canonical" href="https://xwnb.github.io/posts/1181891836/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.css"><style>#needsharebutton-float{bottom:88px;cursor:pointer;left:-8px;position:fixed;z-index:9999}#needsharebutton-float .btn{border:1px solid $btn-default-border-color;border-radius:4px;padding:0 10px 0 14px}</style><title>MEM52-CPP. 检测并处理内存分配错误 | Sun of Beach</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Sun of Beach" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Sun of Beach</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Stay Angry, Stay Foolish</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a role="button" class="book-mark-link book-mark-link-fixed"></a> <a href="https://github.com/xwnb" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://xwnb.github.io/posts/1181891836/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/profile-picture.jpg"><meta itemprop="name" content="村口最靓的 小Xu"><meta itemprop="description" content="个人站，学习记录、实践教程、资料收集等，哈哈哈。"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Sun of Beach"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">MEM52-CPP. 检测并处理内存分配错误</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2021-11-13 23:41:22" itemprop="dateCreated datePublished" datetime="2021-11-13T23:41:22+00:00">2021-11-13</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-11-15 15:33:07" itemprop="dateModified" datetime="2021-11-15T15:33:07+00:00">2021-11-15</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/SEI-CERT-C/" itemprop="url" rel="index"><span itemprop="name">SEI CERT C++</span></a> </span></span><span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span id="busuanzi_value_page_pv"></span></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>3.9k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="far fa-clock"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>4 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>原文链接：</p><p><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/MEM52-CPP.+Detect+and+handle+memory+allocation+errors" target="_blank" rel="noopener">MEM52-CPP. Detect and handle memory allocation errors</a></p><a id="more"></a><hr><p>默认的内存分配操作符, <code>::operator new(std::size_t)</code>, 如果分配失败, 会抛出 <code>std::bad_alloc</code> 异常. 所以, 没必要去检查 <code>::operator new(std::size_t)</code> 的调用结果是否是 <code>nullptr</code>. 不抛出形式, <code>::operator new(std::size_t, const std::nothrow_t &amp;)</code>, 如果分配失败, 不抛出异常, 而是返回 <code>nullptr</code>. 同样的行为也体现在 <code>operator new[]</code> 的两个版本的分配函数上. 此外, 默认分配器 (<code>std::allocator</code>) 使用 <code>::operator new(std::size_t)</code> 来执行分配操作, 应该要被同等看待.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">T *p1 = <span class="keyword">new</span> T; <span class="comment">// Throws std::bad_alloc if allocation fails</span></span><br><span class="line">T *p2 = <span class="keyword">new</span> (<span class="built_in">std</span>::nothrow) T; <span class="comment">// Returns nullptr if allocation fails</span></span><br><span class="line"></span><br><span class="line">T *p3 = <span class="keyword">new</span> T[<span class="number">1</span>]; <span class="comment">// Throws std::bad_alloc if the allocation fails</span></span><br><span class="line">T *p4 = <span class="keyword">new</span> (<span class="built_in">std</span>::nothrow) T[<span class="number">1</span>]; <span class="comment">// Returns nullptr if the allocation fails</span></span><br></pre></td></tr></table></figure><p>进一步, <code>operator new[]</code> 能抛出类型错误 <code>std::bad_array_new_length</code>, 一个 <code>std::bad_alloc</code> 的子类, 如果传入 <code>new</code> 的 <code>size</code> 参数是个负数或者超大值.</p><p>当使用不抛出形式, 在访问该返回的指针前,检查其不是 <code>nullptr</code> 是非常必要的. 使用任一种形式, 确保遵循 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/ERR50-CPP.+Do+not+abruptly+terminate+the+program" target="_blank" rel="noopener">ERR50-CPP. Do not abruptly terminate the program</a>.</p><h2 id="不合规代码示例"><a class="header-anchor" href="#不合规代码示例">¶</a>不合规代码示例</h2><p>在这个不合规的代码示例中, 通过 <code>::operator new[](std::size_t)</code> 构造了一个 <code>int</code> 数组, 但未检查分配的结果. 该函数被标记为 <code>noexcept</code>, 所以调用者假定这个函数不会抛出任何异常. 因为 <code>::operator new[](std::size_t)</code> 在分配失败时能抛出异常, 这可能导致程序 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-abnormaltermination" target="_blank" rel="noopener">异常终止</a> .</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> *<span class="built_in">array</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="built_in">size</span>)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *copy = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">size</span>];</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">memcpy</span>(copy, <span class="built_in">array</span>, <span class="built_in">size</span> * <span class="keyword">sizeof</span>(*copy));</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">delete</span> [] copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-std-nothrow"><a class="header-anchor" href="#合规方案-std-nothrow">¶</a>合规方案 (<code>std::nothrow</code>)</h2><p>当使用 <code>std::nothrow</code>, <code>new</code> 操作符既不会返回空指针,也不会返回指向已分配空间的指针. 在引用这个返回的指针前, 始终得检查它是否是 <code>nullptr</code>. 这个合规方案恰当地处理了返回 <code>nullptr</code> 的这种错误情况.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> *<span class="built_in">array</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="built_in">size</span>)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *copy = <span class="keyword">new</span> (<span class="built_in">std</span>::nothrow) <span class="keyword">int</span>[<span class="built_in">size</span>];</span><br><span class="line">  <span class="keyword">if</span> (!copy) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">memcpy</span>(copy, <span class="built_in">array</span>, <span class="built_in">size</span> * <span class="keyword">sizeof</span>(*copy));</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">delete</span> [] copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-std-bad-alloc"><a class="header-anchor" href="#合规方案-std-bad-alloc">¶</a>合规方案 (<code>std::bad_alloc</code>)</h2><p>另外可选的是, 你可以使用不带 <code>std::nothrow</code> 的 <code>::operator new[]</code> 来替换, 且如果没有分配到足够的内存, 捕捉 <code>std::bad_alloc</code> 异常.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;new&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> *<span class="built_in">array</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="built_in">size</span>)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *copy;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    copy = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">size</span>];</span><br><span class="line">  &#125; <span class="keyword">catch</span>(<span class="built_in">std</span>::bad_alloc) &#123;</span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// At this point, copy has been initialized to allocated memory</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">memcpy</span>(copy, <span class="built_in">array</span>, <span class="built_in">size</span> * <span class="keyword">sizeof</span>(*copy));</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">delete</span> [] copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-noexcept-false"><a class="header-anchor" href="#合规方案-noexcept-false">¶</a>合规方案 (noexcept(false))</h2><p>如果函数设计为期望调用者处理异常情况, 则允许显式地标记该函数为可能会抛出异常, 如该合规方案中所示. 标记这类函数并非严格必须的, 和其他没有 <code>noexcept</code> 修饰符的函数一样, 默认是允许抛出异常.</p><p>If the design of the function is such that the caller is expected to handle exceptional situations, it is permissible to mark the function explicitly as one that may throw, as in this compliant solution. Marking the function is not strictly required, as any function without a <code>noexcept</code> specifier is presumed to allow throwing.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">const</span> <span class="keyword">int</span> *<span class="built_in">array</span>, <span class="built_in">std</span>::<span class="keyword">size_t</span> <span class="built_in">size</span>)</span> <span class="title">noexcept</span><span class="params">(<span class="literal">false</span>)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> *copy = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="built_in">size</span>];</span><br><span class="line">  <span class="comment">// If the allocation fails, it will throw an exception which the caller</span></span><br><span class="line">  <span class="comment">// will have to handle.</span></span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">memcpy</span>(copy, <span class="built_in">array</span>, <span class="built_in">size</span> * <span class="keyword">sizeof</span>(*copy));</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">delete</span> [] copy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="不合规代码示例-v2"><a class="header-anchor" href="#不合规代码示例-v2">¶</a>不合规代码示例</h2><p>在这个不合规的代码示例中, 同一个表达式中执行了两个内存分配操作. 因为内存分配是被当作参数传入到函数调用里的, 其中一个 <code>new</code> 的调用结果抛出的异常可能导致内存泄漏.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span> <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span> <span class="comment">/* ... */</span> &#125;; </span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(A *, B *)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  g(<span class="keyword">new</span> A, <span class="keyword">new</span> B);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>考虑这种情况, <code>A</code> 被分配和构造在先, 然后 <code>B</code> 被分配并抛出异常. 将 <code>g()</code> 的调用包装在 <code>try/catch</code> 块中并不充分, 因为这不能释放已经分配好的 <code>A</code> 的内存.</p><p>这个不合规的代码示例也违背了 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/EXP50-CPP.+Do+not+depend+on+the+order+of+evaluation+for+side+effects" target="_blank" rel="noopener">EXP50-CPP. Do not depend on the order of evaluation for side effects</a>, 因为传入 <code>g()</code> 的实参在计算时顺序时未确定的.</p><h2 id="合规方案-std-unique-ptr"><a class="header-anchor" href="#合规方案-std-unique-ptr">¶</a>合规方案 (<code>std::unique_ptr</code>)</h2><p>在这个合规方案中, 利用 <code>std::unique_ptr</code> 及 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-RAII" target="_blank" rel="noopener">RAII</a> 来管理对象 <code>A</code> 和 <code>B</code> 的资源. 在不合规代码示例所描述的情景中, <code>B</code> 抛出异常仍然将引起对象 <code>A</code> 的析构和释放, 接着 <code>std::unique_ptr&lt;A&gt;</code> 被销毁.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span> <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span> <span class="comment">/* ... */</span> &#125;;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;A&gt; a, <span class="built_in">std</span>::<span class="built_in">unique_ptr</span>&lt;B&gt; b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  g(<span class="built_in">std</span>::make_unique&lt;A&gt;(), <span class="built_in">std</span>::make_unique&lt;B&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="合规方案-References"><a class="header-anchor" href="#合规方案-References">¶</a>合规方案 (References)</h2><p>如果可能, 更适应的合规方案是, 完全移除内存分配, 取而代之通过传入对象的引用.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span> &#123;</span> <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span> &#123;</span> <span class="comment">/* ... */</span> &#125;;</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(A &amp;a, B &amp;b)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  A a;</span><br><span class="line">  B b;</span><br><span class="line">  g(a, b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="风险评估"><a class="header-anchor" href="#风险评估">¶</a>风险评估</h2><p>未成功检测分配错误会导致 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-abnormaltermination" target="_blank" rel="noopener">程序异常终止, abnormal program termination</a> 和 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-denial-of-service" target="_blank" rel="noopener">拒绝服务攻击, denial-of-service attacks</a>.</p><p>如果被攻击的程序从返回值中引用了内存偏移地址, 攻击者可以利用这个程序来任意读写内存. 这种 <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-vulnerability" target="_blank" rel="noopener">漏洞, vulnerability</a> 已经被用于执行任意代码 [<a href="http://www.kb.cert.org/vuls/id/159523" target="_blank" rel="noopener">VU#159523</a>].</p><table><thead><tr><th style="text-align:left">Rule</th><th style="text-align:left">Severity</th><th style="text-align:left">Likelihood</th><th style="text-align:left">Remediation Cost</th><th style="text-align:left">Priority</th><th style="text-align:left">Level</th></tr></thead><tbody><tr><td style="text-align:left">MEM52-CPP</td><td style="text-align:left">High</td><td style="text-align:left">Likely</td><td style="text-align:left">Medium</td><td style="text-align:left"><strong>P18</strong></td><td style="text-align:left"><strong>L1</strong></td></tr></tbody></table><h2 id="Automated-Detection"><a class="header-anchor" href="#Automated-Detection">¶</a>Automated Detection</h2><table><thead><tr><th style="text-align:left">Tool</th><th style="text-align:left">Version</th><th style="text-align:left">Checker</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Rose" target="_blank" rel="noopener">Compass/ROSE</a></td><td style="text-align:left"></td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Coverity" target="_blank" rel="noopener">Coverity</a></td><td style="text-align:left">7.5</td><td style="text-align:left"><strong>CHECKED_RETURN</strong></td><td style="text-align:left">Finds inconsistencies in how function call return values are handled</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Helix+QAC" target="_blank" rel="noopener">Helix QAC</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6SGVsaXggUUFDX1Z9&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>C<ins>3225, C</ins>3226, C<ins>3227, C</ins>3228, C<ins>3229, C</ins>4632</strong></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Klocwork" target="_blank" rel="noopener">Klocwork</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6S2xvY3dvcmtfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CHECK.CALL.MIGHT</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CHECK.CALL.MUST</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CHECK.MIGHT</a><strong><strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CHECK.MUST</a></strong></strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CONST.CALL</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.CONST.DEREF</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.FUNC.CALL.MIGHT</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.FUNC.CALL.MUST</a></strong> <strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.FUNC.MIGHT</a></strong> **<a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.FUNC.MUST</a><strong><strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.GEN.CALL.MIGHT</a> <a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.GEN.CALL.MUST</a> <a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.GEN.MIGHT</a> <a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">NPD.GEN.</a><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">MUST</a></strong></strong><a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">RNPD.CALL</a> <a href="https://support.roguewave.com/documentation/klocwork/en/current/certcandcsecurecodingstandardidsmappedtoklocworkcandccheckers/" target="_blank" rel="noopener">RNPD.DEREF</a> **</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/LDRA" target="_blank" rel="noopener">LDRA tool suite</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6TERSQV9WfQ&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>45 D</strong>** **</td><td style="text-align:left">Partially implemented</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Parasoft" target="_blank" rel="noopener">Parasoft C/C++test</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UGFyYXNvZnRfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>CERT_CPP-MEM52-a</strong> <strong>CERT_CPP-MEM52-b</strong></td><td style="text-align:left">Check the return value of new Do not allocate resources in function argument list because the order of evaluation of a function’s parameters is undefined</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Parasoft" target="_blank" rel="noopener">Parasoft Insure++</a></td><td style="text-align:left"></td><td style="text-align:left"></td><td style="text-align:left">Runtime detection</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/Polyspace+Bug+Finder" target="_blank" rel="noopener">Polyspace Bug Finder</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UG9seXNwYWNlIEJ1ZyBGaW5kZXJfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><a href="https://www.mathworks.com/help/bugfinder/ref/certcmem52cpp.html" target="_blank" rel="noopener">CERT C++: MEM52-CPP</a></td><td style="text-align:left">Checks for unprotected dynamic memory allocation (rule partially covered)</td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046345" target="_blank" rel="noopener">PRQA QA-C++</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFJRQSBRQS1DKytfVn0&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong>3225, 3226, 3227, 3228, 3229, *<em>4632*</em></strong></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/PVS-Studio" target="_blank" rel="noopener">PVS-Studio</a></td><td style="text-align:left"><img data-src="https://wiki.sei.cmu.edu/confluence/plugins/servlet/confluence/placeholder/macro?definition=e2luY2x1ZGU6UFZTLVN0dWRpb19WfQ&amp;locale=zh_CN&amp;version=2" alt="img"></td><td style="text-align:left"><strong><a href="https://pvs-studio.com/en/docs/warnings/v522/" target="_blank" rel="noopener">V522</a>, <a href="https://pvs-studio.com/en/docs/warnings/v668/" target="_blank" rel="noopener">V668</a></strong></td><td style="text-align:left"></td></tr></tbody></table><h2 id="Related-Vulnerabilities"><a class="header-anchor" href="#Related-Vulnerabilities">¶</a>Related Vulnerabilities</h2><p>The <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-vulnerability" target="_blank" rel="noopener">vulnerability</a> in Adobe Flash [<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-VU#159523" target="_blank" rel="noopener">VU#159523</a>] arises because Flash neglects to check the return value from <code>calloc()</code>. Even though <code>calloc()</code> returns <code>NULL</code>, Flash does not attempt to read or write to the return value. Instead, it attempts to write to an offset from the return value. Dereferencing <code>NULL</code> usually results in a program crash, but dereferencing an offset from <code>NULL</code> allows an <a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/BB.+Definitions#BB.Definitions-exploit" target="_blank" rel="noopener">exploit</a> to succeed without crashing the program.</p><p>Search for vulnerabilities resulting from the violation of this rule on the <a href="https://www.kb.cert.org/vulnotes/bymetric?searchview&amp;query=FIELD+KEYWORDS+contains+MEM32-CPP" target="_blank" rel="noopener">CERT website</a>.</p><h2 id="Related-Guidelines"><a class="header-anchor" href="#Related-Guidelines">¶</a>Related Guidelines</h2><table><thead><tr><th><a href="https://wiki.sei.cmu.edu/confluence/display/c/SEI+CERT+C+Coding+Standard" target="_blank" rel="noopener">SEI CERT C Coding Standard</a></th><th><a href="https://wiki.sei.cmu.edu/confluence/display/c/ERR33-C.+Detect+and+handle+standard+library+errors" target="_blank" rel="noopener">ERR33-C. Detect and handle standard library errors</a></th></tr></thead><tbody><tr><td><a href="http://cwe.mitre.org/" target="_blank" rel="noopener">MITRE CWE</a></td><td><a href="http://cwe.mitre.org/data/definitions/252.html" target="_blank" rel="noopener">CWE 252</a>, Unchecked Return Value <a href="http://cwe.mitre.org/data/definitions/391.html" target="_blank" rel="noopener">CWE 391,</a> Unchecked Error Condition <a href="http://cwe.mitre.org/data/definitions/476.html" target="_blank" rel="noopener">CWE 476,</a> NULL Pointer Dereference <a href="http://cwe.mitre.org/data/definitions/703.html" target="_blank" rel="noopener">CWE 690</a>, Unchecked Return Value to NULL Pointer Dereference <a href="http://cwe.mitre.org/data/definitions/703.html" target="_blank" rel="noopener">CWE 703</a>, Improper Check or Handling of Exceptional Conditions <a href="http://cwe.mitre.org/data/definitions/754.html" target="_blank" rel="noopener">CWE 754</a>, Improper Check for Unusual or Exceptional Conditions</td></tr></tbody></table><h2 id="Bibliography"><a class="header-anchor" href="#Bibliography">¶</a>Bibliography</h2><table><thead><tr><th>[<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IEC9899-2011" target="_blank" rel="noopener">ISO/IEC 9899:2011</a>]</th><th>Subclause 7.20.3, “Memory Management Functions”</th></tr></thead><tbody><tr><td>[<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-ISO/IEC14882-2014" target="_blank" rel="noopener">ISO/IEC 14882-2014</a>]</td><td>Subclause 18.6.1.1, “Single-Object Forms” Subclause 18.6.1.2, “Array Forms” Subclause 20.7.9.1, “Allocator Members”</td></tr><tr><td>[<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-Meyers96" target="_blank" rel="noopener">Meyers 1996</a>]</td><td>Item 7, “Be Prepared for Out-of-Memory Conditions”</td></tr><tr><td>[<a href="https://wiki.sei.cmu.edu/confluence/display/cplusplus/AA.+Bibliography#AA.Bibliography-Seacord2013" target="_blank" rel="noopener">Seacord 2013</a>]</td><td>Chapter 4, “Dynamic Memory Management”</td></tr></tbody></table><hr><p><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046362" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_left.png?version=1&amp;modificationDate=1216910800000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_left.png"></a><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046329" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_up.png?version=1&amp;modificationDate=1216910618000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_up.png"></a><a href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=88046356" target="_blank" rel="noopener"><img data-src="https://wiki.sei.cmu.edu/confluence/download/attachments/88046682/button_arrow_right.png?version=1&amp;modificationDate=1216910815000&amp;api=v2" alt="SEI CERT C++ Coding Standard &gt; SEI CERT C++ Coding Standard &gt; button_arrow_right.png"></a></p></div><div class="popular-posts-header">推荐文章</div><ul class="popular-posts"><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/2305000242/" rel="bookmark">MEM56-CPP. 不要在不相关的智能指针中存放一个已有所属的指针值</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/3526747646/" rel="bookmark">MEM55-CPP. 遵守替换动态内存管理的要求</a></div></li><li class="popular-posts-item"><div class="popular-posts-title"><a href="/posts/1817611852/" rel="bookmark">MEM54-CPP. 为 placement new 提供足够内存容量的正确对齐的指针</a></div></li></ul><div class="reward-container"><div></div><button onclick='var e=document.getElementById("qr");e.style.display="none"===e.style.display?"block":"none"'>打赏</button><div id="qr" style="display:none"><div style="display:inline-block"><img src="/images/wechatpay.jpg" alt="村口最靓的 小Xu 微信支付"><p>微信支付</p></div><div style="display:inline-block"><img src="/images/alipay.jpg" alt="村口最靓的 小Xu 支付宝"><p>支付宝</p></div></div></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>村口最靓的 小Xu</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://xwnb.github.io/posts/1181891836/" title="MEM52-CPP. 检测并处理内存分配错误">https://xwnb.github.io/posts/1181891836/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class="followme"><p>欢迎关注我的其它发布渠道</p><div class="social-list"><div class="social-item"><a target="_blank" class="social-link" href="/images/wechat_channel.jpg"><span class="icon"><i class="fab fa-weixin"></i> </span><span class="label">WeChat</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="/atom.xml"><span class="icon"><i class="fa fa-rss"></i> </span><span class="label">RSS</span></a></div><div class="social-item"><a target="_blank" class="social-link" href="https://blog.csdn.net/xiaowei1234565"><span class="icon"><i class="fab fa-blogger"></i> </span><span class="label">CSDN</span></a></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/SEI-CERT-C/" rel="tag"><i class="fa fa-tag"></i> SEI CERT C++</a> <a href="/tags/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/" rel="tag"><i class="fa fa-tag"></i> 编码规范</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" rel="tag"><i class="fa fa-tag"></i> 翻译</a> <a href="/tags/Memory-Management/" rel="tag"><i class="fa fa-tag"></i> Memory Management</a></div><div class="post-widgets"><div class="wp_rating"><div id="wpac-rating"></div></div></div><div class="post-nav"><div class="post-nav-item"><a href="/posts/4036605331/" rel="prev" title="MEM53-CPP. 当手动管理对象生命周期时, 显式构造和析构对象"><i class="fa fa-chevron-left"></i> MEM53-CPP. 当手动管理对象生命周期时, 显式构造和析构对象</a></div><div class="post-nav-item"><a href="/posts/2185119777/" rel="next" title="MEM51-CPP. 正确地释放动态分配的资源">MEM51-CPP. 正确地释放动态分配的资源 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#不合规代码示例"><span class="nav-text">不合规代码示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-std-nothrow"><span class="nav-text">合规方案 (std::nothrow)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-std-bad-alloc"><span class="nav-text">合规方案 (std::bad_alloc)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-noexcept-false"><span class="nav-text">合规方案 (noexcept(false))</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不合规代码示例-v2"><span class="nav-text">不合规代码示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-std-unique-ptr"><span class="nav-text">合规方案 (std::unique_ptr)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#合规方案-References"><span class="nav-text">合规方案 (References)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#风险评估"><span class="nav-text">风险评估</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Automated-Detection"><span class="nav-text">Automated Detection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Related-Vulnerabilities"><span class="nav-text">Related Vulnerabilities</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Related-Guidelines"><span class="nav-text">Related Guidelines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bibliography"><span class="nav-text">Bibliography</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="村口最靓的 小Xu" src="/images/profile-picture.jpg"><p class="site-author-name" itemprop="name">村口最靓的 小Xu</p><div class="site-description" itemprop="description">个人站，学习记录、实践教程、资料收集等，哈哈哈。</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">39</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">25</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/xwnb" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xwnb" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="/www.weibo.com" title="Weibo → www.weibo.com"><i class="fab fa-weibo fa-fw"></i>Weibo</a> </span><span class="links-of-author-item"><a href="/www.google.com" title="Google → www.google.com"><i class="fab fa-google fa-fw"></i>Google</a> </span><span class="links-of-author-item"><a href="https://www.zhihu.com/" title="Zhihu → https:&#x2F;&#x2F;www.zhihu.com" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a></span></div><div class="links-of-blogroll motion-element"><div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i> Friend Links</div><ul class="links-of-blogroll-list"><li class="links-of-blogroll-item"><a href="https://blog.csdn.net/xiaowei1234565" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;xiaowei1234565" rel="noopener" target="_blank">CSDN</a></li><li class="links-of-blogroll-item"><a href="https://www.cnblogs.com/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;" rel="noopener" target="_blank">CNBLOGS</a></li><li class="links-of-blogroll-item"><a href="https://www.oschina.net/" title="https:&#x2F;&#x2F;www.oschina.net&#x2F;" rel="noopener" target="_blank">OSCHINA</a></li><li class="links-of-blogroll-item"><a href="https://www.v2ex.com/" title="https:&#x2F;&#x2F;www.v2ex.com&#x2F;" rel="noopener" target="_blank">V2EX</a></li></ul></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><img src="http://ghchart.rshah.org/xwnb" alt="xwnb's Github chart"><div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="fa fa-user-circle"></i> </span><span class="author" itemprop="copyrightHolder">村口最靓的 小Xu</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-chart-area"></i> </span><span title="站点总字数">135k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span title="站点阅读时长">2:03</span></div><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span class="post-meta-item" id="busuanzi_container_site_uv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-user"></i> </span><span class="site-uv" title="总访客量"><span id="busuanzi_value_site_uv"></span> </span></span><span class="post-meta-divider">|</span> <span class="post-meta-item" id="busuanzi_container_site_pv" style="display:none"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="site-pv" title="总访问量"><span id="busuanzi_value_site_pv"></span></span></span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script><script>!function(){var e,t,o=document.getElementsByTagName("link");if(o.length>0)for(i=0;i<o.length;i++)"canonical"==o[i].rel.toLowerCase()&&o[i].href&&(e=o[i].href);t=e?e.split(":")[0]:window.location.protocol.split(":")[0],e||(e=window.location.href),!function(){var i=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,o=e,r=document.referrer;if(!i.test(o)){var n="https"===String(t).toLowerCase()?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";r?(n+="?r="+encodeURIComponent(document.referrer),o&&(n+="&l="+o)):o&&(n+="?l="+o);var a=new Image;a.src=n}}(window)}()</script><script>if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : ,
      el    : 'wpac-rating',
      color : 'fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }</script><script src="/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script><script>window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://xwnb.github.io/posts/1181891836/',]
      });
      });</script><div id="needsharebutton-float"><span class="btn"><i class="fa fa-share-alt" aria-hidden="true"></i></span></div><script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-needmoreshare2@1/needsharebutton.min.js"></script><script>flOptions={},flOptions.iconStyle="box",flOptions.boxForm="vertical",flOptions.position="middleRight",flOptions.networks="Weibo,Wechat,Douban,QQZone,Twitter,Facebook",new needShareButton("#needsharebutton-float",flOptions)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><meting-js server="netease" type="playlist" id="60498371" autoplay fixed="true" mutex="true" order="random"></meting-js></body></html><!-- rebuild by neat -->